<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>OnixS C++ B3 BOE Binary Order Entry: Message Throttling</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="onixs-doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
    $(window).scroll(function() {
        if ($(this).scrollTop() > 1)
        {
            $('header').addClass("sticky");
        }
        else
        {
            $('header').removeClass("sticky");
        }
    });
    </script>
</head>
<body>
<header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
<tbody>
    <tr style="height: 56px;">
        <td id="projectlogo"><a href="http://www.onixs.biz"><img alt="Logo" src="onixs.svg"/></a></td>
        <td style="padding-left: 0.5em;">
            <div id="projectname">OnixS C++ B3 BOE Binary Order Entry
            &#160;<span id="projectnumber">1.3.0</span>
            </div>
            <div id="projectbrief">API Documentation</div>
        </td>
    </tr>
</tbody>
</table>
</div>
</header>
<div id="wrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="modules.html"><span>Contents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Message Throttling<div class="ingroups"><a class="el" href="group__advanced-programming.html">Advanced Programming</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The B3 has limits on sending messages per time unit (throttling). If an application sends messages too often, they can be rejected, and finally, the session can be terminated. To not exceeds the limits, there is the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#a1f18e0e82743f633b0281c9fe068d1d7" title="Performs the throttling of a session that must be called before each send function call...">OnixS::B3::BOE::Session::throttle</a> method. This method performs the throttling of a session. It must be called before each send function call. If the count of messages per time unit exceeds a throttling limit, the function will be blocked until the given time interval is passed. The waiting is performed in the busy-wait (spin) mode to exclude the context switching overhead. The <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#a338dfc3d4562aa9aae5bc8841d78f316" title="Sets throttling limit parameters. ">OnixS::B3::BOE::Session::throttlingLimit</a> method is used to set throttling limit parameters:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html">OnixS::B3::BOE</a>;</div><div class="line"></div><div class="line"><a class="code" href="classOnixS_1_1B3_1_1BOE_1_1SessionSettings.html">SessionSettings</a> settings;</div><div class="line"></div><div class="line"><a class="code" href="classOnixS_1_1B3_1_1BOE_1_1Session.html">Session</a> session(settings, &amp;sessionListener);</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> MessagesPerSecondLimit = 10;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> ThrottlingIntervalMillisecond = 1000;</div><div class="line"></div><div class="line"><span class="comment">// Set throttling limit parameters.</span></div><div class="line">session.throttlingLimit(MessagesPerSecondLimit, ThrottlingIntervalMillisecond);</div><div class="line"></div><div class="line">session.connect(CounterpartyHost, CounterpartyPort);</div><div class="line"></div><div class="line"><a class="code" href="classOnixS_1_1B3_1_1BOE_1_1Messaging_1_1MessageHolder.html">MessageHolder&lt;NewOrderSingle102&gt;</a> order;</div><div class="line"></div><div class="line"><span class="comment">// Emulate some sending flow of an application.</span></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> counter = 0; counter &lt; 100; ++counter)</div><div class="line">{</div><div class="line">    <span class="comment">// This method must be called before each send function call.</span></div><div class="line">    <span class="comment">// If the count of messages (10 in our case) per time unit (1 sec in our case) exceeds the throttling limit,</span></div><div class="line">    <span class="comment">// this function will be blocked until the given time interval is passed.</span></div><div class="line">    session.throttle();</div><div class="line">    <span class="comment">// A regular send call, which should be throttled.</span></div><div class="line">    session.send(order);</div><div class="line">}</div></div><!-- fragment --><p> Also, there is the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ab5e1c165798478fdb497cc57f441c5db" title="Checks the throttling of a session that must be called before each send function call. ">OnixS::B3::BOE::Session::tryThrottle</a> method. It checks the throttling of a session, but it does not block the execution. If the count of messages per time unit exceeds the throttling limit, the function returns the delay (in milliseconds) until the sending becomes possible. Otherwise, it returns <code>0</code>. This method can be helpful when one needs to detect that the message's rate exceeds the limit and react in some specific way:</p>
<div class="fragment"><div class="line"><span class="comment">// Emulate some sending flow of an application.</span></div><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> counter = 0; counter &lt; 100; ++counter)</div><div class="line">{</div><div class="line">    <span class="comment">// This method must be called before each send function call.</span></div><div class="line">    <span class="comment">// If the count of messages (10 in our case) per time unit (1 sec in our case) exceeds the throttling limit,</span></div><div class="line">    <span class="comment">// the function returns the delay (in milliseconds) until the sending becomes possible. Otherwise, it returns 0.</span></div><div class="line">    <span class="keywordflow">if</span>(<span class="keywordtype">size_t</span> delay = session.tryThrottle())</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;The message&#39;s rate exceeds the limit. &quot;</span> &lt;&lt; delay &lt;&lt; <span class="stringliteral">&quot; milliseconds should be passed until the sending becomes possible.&quot;</span> &lt;&lt; std::endl;</div><div class="line">        <span class="comment">// Wait for the &#39;delay&#39; milliseconds or do some another specific actions if necessary.</span></div><div class="line">    }</div><div class="line">    <span class="comment">// A regular send call, which should be throttled.</span></div><div class="line">    session.send(order);</div><div class="line">}</div></div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<footer>
<hr class="footer"/>
<address class="footer">
    <small>&copy; <a href="http://www.onixs.biz">Onix Solutions [On<span class="corporate-orange">i</span>x<span class="corporate-orange">S</span>]</a>. All rights reserved.</small>
</address>
</footer>
</div> <!-- wrapper -->
</body>
</html>
