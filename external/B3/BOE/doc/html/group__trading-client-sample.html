<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>OnixS C++ B3 BOE Binary Order Entry: Trading Client Sample</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="onixs-doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
    $(window).scroll(function() {
        if ($(this).scrollTop() > 1)
        {
            $('header').addClass("sticky");
        }
        else
        {
            $('header').removeClass("sticky");
        }
    });
    </script>
</head>
<body>
<header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
<tbody>
    <tr style="height: 56px;">
        <td id="projectlogo"><a href="http://www.onixs.biz"><img alt="Logo" src="onixs.svg"/></a></td>
        <td style="padding-left: 0.5em;">
            <div id="projectname">OnixS C++ B3 BOE Binary Order Entry
            &#160;<span id="projectnumber">1.3.0</span>
            </div>
            <div id="projectbrief">API Documentation</div>
        </td>
    </tr>
</tbody>
</table>
</div>
</header>
<div id="wrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="modules.html"><span>Contents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Trading Client Sample<div class="ingroups"><a class="el" href="group__samples.html">Samples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>An advanced interactive console application to send orders and receive responses.</p>
<h1>Source code</h1>
<ul>
<li><a href="#cui-h">CUI.h</a></li>
<li><a href="#settings-h">Settings.h</a></li>
<li><a href="#settings-cpp">Settings.cpp</a></li>
<li><a href="#book-h">Book.h</a></li>
<li><a href="#order-h">Order.h</a></li>
<li><a href="#order-cpp">Order.cpp</a></li>
<li><a href="#message-factory-h">MessageFactory.h</a></li>
<li><a href="#message-factory-cpp">MessageFactory.cpp</a></li>
<li><a href="#trading-client-h">TradingClient.h</a></li>
<li><a href="#trading-client-cpp">TradingClient.cpp</a></li>
<li><a href="#main-cpp">Main.cpp</a></li>
</ul>
<h2>CUI.h <a class="anchor" id="cui-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Thread_8h.html">OnixS/B3/BOE/threading/Thread.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Mutex_8h.html">OnixS/B3/BOE/threading/Mutex.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Guard_8h.html">OnixS/B3/BOE/threading/Guard.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Typification_8h.html">OnixS/B3/BOE/messaging/Typification.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;Book.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>CUI {</div><div class="line"></div><div class="line"><span class="comment">// Utility class which provides facilities to notify a user</span></div><div class="line"><span class="comment">// about important events like an incoming message receipt.</span></div><div class="line"><span class="keyword">struct </span>Screen</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span>MessagePrinter</div><div class="line">    {</div><div class="line">        <span class="keyword">explicit</span> MessagePrinter(<span class="keyword">const</span> std::string&amp; prefix) : prefix_(prefix) {}</div><div class="line"></div><div class="line">        <span class="keyword">template</span> &lt;<span class="keyword">typename</span> MessageType&gt;</div><div class="line">        <span class="keywordtype">void</span> operator()(<span class="keyword">const</span> MessageType&amp; msg)<span class="keyword"> const</span></div><div class="line"><span class="keyword">        </span>{</div><div class="line">            info(prefix_, msg.toString());</div><div class="line">        }</div><div class="line"></div><div class="line">        std::string prefix_;</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="keyword">typedef</span> Threading::Mutex Mutex;</div><div class="line">    <span class="keyword">typedef</span> Threading::Guard&lt;Threading::Mutex&gt; Guard;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> Mutex&amp; mutex()</div><div class="line">    {</div><div class="line">        <span class="keyword">static</span> Mutex mutex;</div><div class="line">        <span class="keywordflow">return</span> mutex;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> std::string getInput()</div><div class="line">    {</div><div class="line">        std::string userInput;</div><div class="line">        std::getline(std::cin, userInput);</div><div class="line">        <span class="keywordflow">return</span> userInput;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line">    <span class="keyword">static</span> T getInput(<span class="keyword">const</span> T &amp; defaultValue = T())</div><div class="line">    {</div><div class="line">        std::string userInput;</div><div class="line">        std::getline(std::cin, userInput);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (userInput.empty())</div><div class="line">            <span class="keywordflow">return</span> defaultValue;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            Messaging::Int64 converted = Messaging::Int64();</div><div class="line">            std::istringstream ss(userInput);</div><div class="line">            ss &gt;&gt; converted;</div><div class="line">            <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(converted);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> getInput(T &amp; value, <span class="keyword">const</span> T &amp; defaultValue = T())</div><div class="line">    {</div><div class="line">        std::string userInput;</div><div class="line">        std::getline(std::cin, userInput);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (userInput.empty())</div><div class="line">            value = defaultValue;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            Messaging::Int64 converted = Messaging::Int64();</div><div class="line">            std::istringstream ss(userInput);</div><div class="line">            ss &gt;&gt; converted;</div><div class="line">            value = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(converted);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> getInputLocalMktDate(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a1ce830b8d7e3e57e5d44498eae99355d">LocalMktDate</a> &amp; value)</div><div class="line">    {</div><div class="line">        std::string userInput;</div><div class="line">        std::getline(std::cin, userInput);</div><div class="line"></div><div class="line">        Timestamp timestamp;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span>(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a3c0506f94aa1067ba067ffef3ab3fee5">fromStr</a>(timestamp, userInput, TimestampFormat::YYYYMMDD))</div><div class="line">            value = <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a07a46ee2db9e8852b47778943737800d">timestampToLocalMktDate</a>(timestamp);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            value = 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> getInputChar(T &amp; value, <span class="keyword">const</span> T &amp; defaultValue = T())</div><div class="line">    {</div><div class="line">        std::string userInput;</div><div class="line">        std::getline(std::cin, userInput);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (userInput.empty())</div><div class="line">            value = defaultValue;</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7942e32f6409fbd1fd347a8c23ef725e">Messaging::Char</a> converted = <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7942e32f6409fbd1fd347a8c23ef725e">Messaging::Char</a>();</div><div class="line">            std::istringstream ss(userInput);</div><div class="line">            ss &gt;&gt; converted;</div><div class="line">            value = <span class="keyword">static_cast&lt;</span>T<span class="keyword">&gt;</span>(converted);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> info(<span class="keyword">const</span> std::string&amp; message)</div><div class="line">    {</div><div class="line">        info(<span class="stringliteral">&quot;INFO: &quot;</span>, message);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> info(<span class="keyword">const</span> std::string&amp; prefix, <span class="keyword">const</span> std::string&amp; message)</div><div class="line">    {</div><div class="line">        Guard g(mutex());</div><div class="line"></div><div class="line">        std::cout &lt;&lt; std::endl &lt;&lt; prefix &lt;&lt; message &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> out(<span class="keyword">const</span> std::string&amp; message)</div><div class="line">    {</div><div class="line">        Guard g(mutex());</div><div class="line"></div><div class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> out(<span class="keyword">const</span> std::string&amp; prefix, <span class="keyword">const</span> SbeMessage&amp; message)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (!<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a28d72d084158aecf0922e288b29f5f63">processTypified</a>(message, MessagePrinter(prefix)))</div><div class="line">            info(<span class="stringliteral">&quot;Unknown message type.&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> ItemType&gt;</div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> outItems(<span class="keyword">const</span> ItemType &amp; items)</div><div class="line">    {</div><div class="line">        Guard g(mutex());</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> index = 0; index &lt; items.size(); ++index)</div><div class="line">            std::cout &lt;&lt; (index + 1) &lt;&lt; <span class="stringliteral">&quot;) &quot;</span> &lt;&lt; items[index].text &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">bool</span> shouldContinue()</div><div class="line">    {</div><div class="line">        {</div><div class="line">            Guard g(mutex());</div><div class="line">            std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Press &lt;Enter&gt; to view next page or Enter &#39;quit&#39; to abort current action: &quot;</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keyword">const</span> std::string userInput = getInput();</div><div class="line"></div><div class="line">        {</div><div class="line">            Guard g(mutex());</div><div class="line">            std::cout &lt;&lt; std::endl;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> userInput.empty();</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Command execution status represents command execution feedback.</span></div><div class="line"></div><div class="line"><span class="keyword">enum</span> CommandExecutionStatus</div><div class="line">{</div><div class="line">    TerminateExecution,</div><div class="line">    ContinueExecution,</div><div class="line">    RepeatExecution</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Abstraction of the main menu for the application.</span></div><div class="line"><span class="comment">// Implemented as a template to simplify command handling.</span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Owner&gt;</div><div class="line"><span class="keyword">class </span>Menu</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Command, which is invoked on a menu item selection.</span></div><div class="line">    <span class="keyword">typedef</span> void (Owner::*Command)(CommandExecutionStatus*);</div><div class="line"></div><div class="line">    <span class="comment">// Initializes an empty menu.</span></div><div class="line">    <span class="keyword">explicit</span> Menu(Owner* owner)</div><div class="line">      : owner_(owner)</div><div class="line">    {</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Utilizes resources.</span></div><div class="line">    ~Menu()</div><div class="line">    {</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Adds a new menu item to the menu.</span></div><div class="line">    Menu&amp; add(<span class="keyword">const</span> std::string&amp; text, <span class="keyword">const</span> std::string&amp; commandText, Command command)</div><div class="line">    {</div><div class="line">        items_.push_back(Item(text, commandText, command));</div><div class="line">        <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Process user requests until any command terminates the execution.</span></div><div class="line">    <span class="keywordtype">void</span> processRequests()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        CommandExecutionStatus status = ContinueExecution;</div><div class="line"></div><div class="line">        <span class="keywordflow">while</span> (TerminateExecution != status)</div><div class="line">        {</div><div class="line">            outputItems();</div><div class="line">            processRequest(&amp;status);</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// Menu item-related attributes.</span></div><div class="line">    <span class="keyword">struct </span>Item</div><div class="line">    {</div><div class="line">        Item(<span class="keyword">const</span> std::string&amp; itemText, <span class="keyword">const</span> std::string&amp; itemCommandText, Command itemCommand)</div><div class="line">            : text(itemText)</div><div class="line">            , commandText(itemCommandText)</div><div class="line">            , command(itemCommand)</div><div class="line">        {</div><div class="line">        }</div><div class="line"></div><div class="line">        Item(<span class="keyword">const</span> Item&amp; other)</div><div class="line">            : text(other.text)</div><div class="line">            , commandText(other.commandText)</div><div class="line">            , command(other.command)</div><div class="line">        {</div><div class="line">        }</div><div class="line"></div><div class="line">        std::string text;</div><div class="line">        std::string commandText;</div><div class="line">        Command command;</div><div class="line">    };</div><div class="line"></div><div class="line">    <span class="comment">// Instance of the class whose members are invoked as menu commands.</span></div><div class="line">    Owner* owner_;</div><div class="line"></div><div class="line">    <span class="comment">// Menu items.</span></div><div class="line">    std::vector&lt;Item&gt; items_;</div><div class="line"></div><div class="line">    <span class="comment">// Outputs items&#39; names onto the screen.</span></div><div class="line">    <span class="comment">// Assigns a sequence number to each item for future reference.</span></div><div class="line">    <span class="keywordtype">void</span> outputItems()<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Select operation you want to perform: &quot;</span>);</div><div class="line"></div><div class="line">        Screen::outItems(items_);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Invokes command associated with the menu item selected by the user.</span></div><div class="line">    <span class="keywordtype">void</span> processRequest(CommandExecutionStatus* status)<span class="keyword"> const</span></div><div class="line"><span class="keyword">    </span>{</div><div class="line">        Screen::out(<span class="stringliteral">&quot;Enter your choice : &quot;</span>);</div><div class="line"></div><div class="line">        std::string userInput = Screen::getInput();</div><div class="line"></div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">size_t</span> selectedItemNumber = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(atoi(userInput.c_str()) - 1);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (items_.size() &lt;= selectedItemNumber)</div><div class="line">        {</div><div class="line">            Screen::info(<span class="stringliteral">&quot;Invalid command requested. Repeat your choice.&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordflow">try</span></div><div class="line">            {</div><div class="line">                <span class="keyword">const</span> Item&amp; selectedItem = items_[selectedItemNumber];</div><div class="line"></div><div class="line">                Screen::info(selectedItem.commandText);</div><div class="line"></div><div class="line">                (owner_-&gt;*(selectedItem.command))(status);</div><div class="line"></div><div class="line">                <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> CommandExecutionTimeout = 500;</div><div class="line"></div><div class="line">                <span class="comment">// Wait for some timeout to give to complete the command</span></div><div class="line">                <span class="comment">// and print the corresponding responses to make the output more readable.</span></div><div class="line">                Threading::ThisThread::sleep(CommandExecutionTimeout);</div><div class="line">            }</div><div class="line">            <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex)</div><div class="line">            {</div><div class="line">                Screen::info(<span class="stringliteral">&quot;ERROR: &quot;</span>, ex.what());</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// Abstraction of a list viewer, which outputs list items on a per-page basis.</span></div><div class="line"><span class="comment">// Implemented as a template to abstract from the list items type, which must support</span></div><div class="line"><span class="comment">// the ability to return its string presentation through the toString() member.</span></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> Stringable&gt;</div><div class="line"><span class="keyword">class </span>ListViewer</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> Samples::Book&lt;Stringable&gt;::EntryList StringableList;</div><div class="line"></div><div class="line">    <span class="comment">// Outputs list items on the screen.</span></div><div class="line">    <span class="keyword">static</span> <span class="keywordtype">void</span> outputItems(<span class="keyword">const</span> StringableList&amp; items, <span class="keywordtype">size_t</span> itemsPerPage)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (0 == items.size())</div><div class="line">        {</div><div class="line">            Screen::info(<span class="stringliteral">&quot;No items available.&quot;</span>);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            <span class="keywordtype">size_t</span> itemNumber = 0;</div><div class="line">            <span class="keywordtype">size_t</span> itemsToOutput = itemsPerPage;</div><div class="line"></div><div class="line">            <span class="keywordflow">for</span> (StringableListConstEntry itemPtr = items.begin(); itemPtr != items.end(); ++itemPtr)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (0 == --itemsToOutput)</div><div class="line">                {</div><div class="line">                    itemsToOutput = itemsPerPage;</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (!Screen::shouldContinue())</div><div class="line">                        <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                Screen::out(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(++itemNumber) + <span class="stringliteral">&quot;) &quot;</span> + (*itemPtr)-&gt;toString() + <span class="stringliteral">&quot;.&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> StringableList::const_iterator StringableListConstEntry;</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Settings.h <a class="anchor" id="settings-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">class </span>Settings</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">explicit</span> Settings(<span class="keyword">const</span> std::string&amp; filePath);</div><div class="line"></div><div class="line">    std::string <span class="keyword">get</span>(<span class="keyword">const</span> std::string&amp; key) <span class="keyword">const</span>;</div><div class="line">    std::string <span class="keyword">get</span>(<span class="keyword">const</span> std::string&amp; key, <span class="keyword">const</span> std::string&amp; defaultValue) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    std::string getIfAny(<span class="keyword">const</span> std::string&amp; key) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> getAsInt(<span class="keyword">const</span> std::string&amp; key) <span class="keyword">const</span>;</div><div class="line">    <span class="keywordtype">int</span> getAsInt(<span class="keyword">const</span> std::string&amp; key, <span class="keywordtype">int</span> defaultValue) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> getAsBool(<span class="keyword">const</span> std::string&amp; key) <span class="keyword">const</span>;</div><div class="line">    <span class="keywordtype">bool</span> getAsBool(<span class="keyword">const</span> std::string&amp; key, <span class="keywordtype">bool</span> defaultValue) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> isSet(<span class="keyword">const</span> std::string&amp; key) <span class="keyword">const</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">typedef</span> std::map&lt;std::string, std::string&gt; Key2ValueMap;</div><div class="line">    <span class="keyword">typedef</span> Key2ValueMap::const_iterator Key2ValueMapEntry;</div><div class="line"></div><div class="line">    Key2ValueMap map_;</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Settings.cpp <a class="anchor" id="settings-cpp"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span></div><div class="line">{</div><div class="line">    <span class="keywordtype">void</span> trimSpaces(std::string* str)</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span> whiteSpace[] = <span class="stringliteral">&quot; \t\r&quot;</span>;</div><div class="line"></div><div class="line">        <span class="keywordtype">size_t</span> found = str-&gt;find_last_not_of(whiteSpace);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (std::string::npos == found)</div><div class="line">            str-&gt;resize(0);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            str-&gt;resize(found + 1);</div><div class="line"></div><div class="line">        found = str-&gt;find_first_not_of(whiteSpace);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (std::string::npos != found &amp;&amp; 0 != found)</div><div class="line">            str-&gt;erase(0, found);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> lexicalCompare(<span class="keyword">const</span> std::string&amp; left, <span class="keyword">const</span> std::string&amp; right)</div><div class="line">    {</div><div class="line"><span class="preprocessor">#if defined(_WIN32)</span></div><div class="line">        <span class="keywordflow">return</span> _stricmp(left.c_str(), right.c_str());</div><div class="line"><span class="preprocessor">#else</span></div><div class="line">        <span class="keywordflow">return</span> strcasecmp(left.c_str(), right.c_str());</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"></div><div class="line">Settings::Settings(<span class="keyword">const</span> std::string&amp; filePath)</div><div class="line">{</div><div class="line">    std::ifstream in(filePath.c_str());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!in)</div><div class="line">    {</div><div class="line">        std::string errReason(<span class="stringliteral">&quot;Cannot open the settings file &#39;&quot;</span>);</div><div class="line"></div><div class="line">        errReason += filePath;</div><div class="line">        errReason += <span class="stringliteral">&quot;&#39;&quot;</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">throw</span> std::domain_error(errReason);</div><div class="line">    }</div><div class="line"></div><div class="line">    std::string line;</div><div class="line"></div><div class="line">    <span class="keywordflow">while</span> (getline(in, line))</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> std::string::size_type comment = line.find(<span class="charliteral">&#39;#&#39;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (std::string::npos != comment)</div><div class="line">            line.resize(comment);</div><div class="line"></div><div class="line">        std::string::size_type separator = line.find(<span class="charliteral">&#39;=&#39;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (std::string::npos == separator)</div><div class="line">            <span class="keywordflow">continue</span>;</div><div class="line"></div><div class="line">        std::string key = line.substr(0, separator);</div><div class="line"></div><div class="line">        trimSpaces(&amp;key);</div><div class="line"></div><div class="line">        std::string value = line.substr(separator + 1);</div><div class="line"></div><div class="line">        trimSpaces(&amp;value);</div><div class="line"></div><div class="line">        map_.insert(make_pair(key, value));</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line">std::string Settings::get(<span class="keyword">const</span> std::string&amp; key)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> Key2ValueMapEntry it = map_.find(key);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (map_.end() == it)</div><div class="line">    {</div><div class="line">        std::string errReason(<span class="stringliteral">&quot;There&#39;s no setting &#39;&quot;</span>);</div><div class="line"></div><div class="line">        errReason += key;</div><div class="line">        errReason += <span class="stringliteral">&quot;&#39; available&quot;</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">throw</span> std::domain_error(errReason);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> it-&gt;second;</div><div class="line">}</div><div class="line"></div><div class="line">std::string Settings::get(<span class="keyword">const</span> std::string&amp; key, <span class="keyword">const</span> std::string&amp; defaultValue)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> Key2ValueMapEntry it = map_.find(key);</div><div class="line">    <span class="keywordflow">return</span> (map_.end() == it) ? defaultValue : it-&gt;second;</div><div class="line">}</div><div class="line"></div><div class="line">std::string Settings::getIfAny(<span class="keyword">const</span> std::string&amp; key)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">get</span>(key, std::string());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> Settings::getAsInt(<span class="keyword">const</span> std::string&amp; key)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> std::string value = <span class="keyword">get</span>(key);</div><div class="line">    <span class="keywordflow">return</span> atoi(value.c_str());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> Settings::getAsInt(<span class="keyword">const</span> std::string&amp; key, <span class="keywordtype">int</span> defaultValue)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> std::string value = getIfAny(key);</div><div class="line">    <span class="keywordflow">return</span> value.empty() ? defaultValue : atoi(value.c_str());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> Settings::getAsBool(<span class="keyword">const</span> std::string&amp; key)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> std::string value = <span class="keyword">get</span>(key);</div><div class="line">    <span class="keywordflow">return</span> 0 == lexicalCompare(<span class="stringliteral">&quot;true&quot;</span>, value);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> Settings::getAsBool(<span class="keyword">const</span> std::string&amp; key, <span class="keywordtype">bool</span> defaultValue)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">const</span> std::string value = getIfAny(key);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> !value.empty() ? 0 == lexicalCompare(<span class="stringliteral">&quot;true&quot;</span>, value) : defaultValue;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> Settings::isSet(<span class="keyword">const</span> std::string&amp; key)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keywordflow">return</span> map_.count(key) &gt; 0;</div><div class="line">}</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Book.h <a class="anchor" id="book-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"></div><div class="line"><span class="comment">// Collection of book entries (e.g., orders) currently manipulated by the trading client.</span></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EntryType&gt;</div><div class="line"><span class="keyword">class </span>Book</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">typedef</span> std::map&lt;ClOrdID, EntryType&gt; BookEntries;</div><div class="line">    <span class="keyword">typedef</span> <span class="keyword">typename</span> BookEntries::iterator EntryIter;</div><div class="line"></div><div class="line">    <span class="comment">// Adds an entry to the book.</span></div><div class="line">    Book&amp; store(<span class="keyword">const</span> EntryType&amp; entry);</div><div class="line">    Book&amp; store(<span class="keyword">const</span> EntryType&amp; entry, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> <span class="keywordtype">id</span>);</div><div class="line"></div><div class="line">    <span class="comment">// Finds an instance of the entry by its identifier.</span></div><div class="line">    <span class="comment">// If there&#39;s no entry available, returns NULL.</span></div><div class="line">    EntryType* find(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> <span class="keywordtype">id</span>);</div><div class="line"></div><div class="line">    <span class="keyword">typedef</span> std::vector&lt;EntryType*&gt; EntryList;</div><div class="line"></div><div class="line">    <span class="comment">// Returns a collection of stored book entries.</span></div><div class="line">    <span class="keywordtype">void</span> getEntries(EntryList &amp; list);</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="keyword">typedef</span> Threading::Mutex Mutex;</div><div class="line">    <span class="keyword">typedef</span> Threading::Guard&lt;Threading::Mutex&gt; Guard;</div><div class="line"></div><div class="line">    Mutex mutex_;</div><div class="line">    BookEntries entries_;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EntryType&gt;</div><div class="line">Book&lt;EntryType&gt;&amp; Book&lt;EntryType&gt;::store(<span class="keyword">const</span> EntryType&amp; newEntry)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> store(newEntry, newEntry.id());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EntryType&gt;</div><div class="line">Book&lt;EntryType&gt;&amp; Book&lt;EntryType&gt;::store(<span class="keyword">const</span> EntryType&amp; newEntry, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> <span class="keywordtype">id</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> Guard guard(mutex_);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> std::pair&lt;EntryIter, bool&gt; result = entries_.insert(std::make_pair(<span class="keywordtype">id</span>, newEntry));</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!result.second)</div><div class="line">    {</div><div class="line">        std::stringstream ss;</div><div class="line">        ss &lt;&lt; <span class="stringliteral">&quot;Book already has an entry registered under ID = &#39;&quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span>;</div><div class="line">        <span class="keywordflow">throw</span> std::domain_error(ss.str());</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EntryType&gt;</div><div class="line">EntryType* Book&lt;EntryType&gt;::find(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> <span class="keywordtype">id</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> Guard guard(mutex_);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> EntryIter entry = entries_.find(<span class="keywordtype">id</span>);</div><div class="line">    <span class="keywordflow">return</span> entry == entries_.end() ? <a class="code" href="Compiler_8h.html#a7aebce3454c06095b826f378c1fa860b">ONIXS_B3_BOE_NULLPTR</a> : &amp;entry-&gt;second;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> EntryType&gt;</div><div class="line"><span class="keywordtype">void</span> Book&lt;EntryType&gt;::getEntries(Book&lt;EntryType&gt;::EntryList &amp; list)</div><div class="line">{</div><div class="line">    <span class="keyword">const</span> Guard guard(mutex_);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (EntryIter iter = entries_.begin(); iter != entries_.end(); ++iter)</div><div class="line">        list.push_back(&amp;iter-&gt;second);</div><div class="line">}</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Order.h <a class="anchor" id="order-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Integral_8h.html">OnixS/B3/BOE/messaging/Integral.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"></div><div class="line"><span class="keyword">struct </span>Order</div><div class="line">{</div><div class="line">    <span class="comment">// Initializes an order.</span></div><div class="line">    Order();</div><div class="line"></div><div class="line">    <span class="comment">// Human-readable presentation of the most interesting fields stored in the order.</span></div><div class="line">    std::string toString() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Returns a unique order id.</span></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> id() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Setters.</span></div><div class="line">    Order&amp; cIOrdId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> value);</div><div class="line">    Order&amp; orderId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a3ac247d4654e2a2f78d192c964337073">OrderID</a> value);</div><div class="line">    Order&amp; price(UInt64 value);</div><div class="line">    Order&amp; orderQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value);</div><div class="line">    Order&amp; minQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value);</div><div class="line">    Order&amp; leavesQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value);</div><div class="line">    Order&amp; cumQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value);</div><div class="line">    Order&amp; securityId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a654231565949f4ec9201c4b7ba2bb5a7">SecurityID</a> value);</div><div class="line">    Order&amp; side(Side::Enum value);</div><div class="line">    Order&amp; ordType(OrdType::Enum value);</div><div class="line">    Order&amp; stopPx(Int64 value);</div><div class="line">    Order&amp; timeInForce(TimeInForce::Enum value);</div><div class="line">    Order&amp; expireDate(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a1ce830b8d7e3e57e5d44498eae99355d">LocalMktDate</a> value);</div><div class="line">    Order&amp; orderStatus(OrdStatus::Enum value);</div><div class="line">    Order&amp; lastPx(Int64 value);</div><div class="line">    Order&amp; transactTime(UInt64 value);</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> cIOrdId_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a3ac247d4654e2a2f78d192c964337073">OrderID</a> orderId_;</div><div class="line">    Int64 price_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7df5b61fdd93600e68b67f2c5c8251b3">QuantityOptional</a> orderQty_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7df5b61fdd93600e68b67f2c5c8251b3">QuantityOptional</a> minQty_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7df5b61fdd93600e68b67f2c5c8251b3">QuantityOptional</a> leavesQty_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7df5b61fdd93600e68b67f2c5c8251b3">QuantityOptional</a> cumQty_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a654231565949f4ec9201c4b7ba2bb5a7">SecurityID</a> securityId_;</div><div class="line">    Side::Enum side_;</div><div class="line">    OrdType::Enum ordType_;</div><div class="line">    Int64 stopPx_;</div><div class="line">    TimeInForce::Enum timeInForce_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a1ce830b8d7e3e57e5d44498eae99355d">LocalMktDate</a> expireDate_;</div><div class="line">    OrdStatus::Enum orderStatus_;</div><div class="line">    Int64 lastPx_;</div><div class="line">    UInt64 transactTime_;</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Order.cpp <a class="anchor" id="order-cpp"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Order.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;../Common/Helpers.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"></div><div class="line">Order::Order()</div><div class="line">    : cIOrdId_(IdGenerator::newId())</div><div class="line">    , orderId_()</div><div class="line">    , price_(NullPriceOptional::NullMantissa().value())</div><div class="line">    , orderQty_()</div><div class="line">    , minQty_(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">    , leavesQty_(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">    , cumQty_(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">    , securityId_()</div><div class="line">    , side_(Side::Buy)</div><div class="line">    , ordType_(OrdType::Limit)</div><div class="line">    , stopPx_(NullPriceOptional::NullMantissa().value())</div><div class="line">    , timeInForce_(TimeInForce::Day)</div><div class="line">    , expireDate_(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#afd78ad0fe655e5f174cb130a21b42b0a">NullUInt16</a>().value())</div><div class="line">    , orderStatus_(OrdStatus::New)</div><div class="line">    , lastPx_()</div><div class="line">    , transactTime_()</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</div><div class="line">std::string toStrOptional(T value, T emptyValue)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> value == emptyValue ? std::string() : <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(value);</div><div class="line">}</div><div class="line"></div><div class="line">std::string Order::toString()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    std::ostringstream builder;</div><div class="line"></div><div class="line">    builder</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;ClOrdID = &quot;</span> &lt;&lt; cIOrdId_</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, OrderID = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(orderId_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, SecurityId = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(securityId_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, OrderStatus = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(orderStatus_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, Type = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(ordType_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, Price = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(price_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, Quantity = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(orderQty_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, MinQty = &quot;</span> &lt;&lt; toStrOptional(minQty_, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, LeavesQty = &quot;</span> &lt;&lt; toStrOptional(leavesQty_, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, CumQty = &quot;</span> &lt;&lt; toStrOptional(cumQty_, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value())</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, Side = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(side_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, StopPx = &quot;</span> &lt;&lt; toStrOptional(stopPx_, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1NullPriceOptional.html#a1474b437bb420c59fe9d5e06c1ebc6fc">NullPriceOptional::NullMantissa</a>().value())</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, LastFillPrice = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(lastPx_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, TimeInForce = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(timeInForce_)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, ExpireDate = &quot;</span> &lt;&lt; <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a215dff2462e661d28d4d2e681d9add6d">localMktDateToTimestamp</a>(expireDate_), <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1TimestampFormat.html#a8150b7776c2a1749101acf22e868d091ab9f60efb642df6dda3ed61d251ed3d0d">TimestampFormat::YYYYMMDD</a>)</div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;, TransactTime = &quot;</span> &lt;&lt; Timestamp(transactTime_).toString();</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> builder.str();</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> Order::id()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keywordflow">return</span> cIOrdId_;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::cIOrdId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> value)</div><div class="line">{</div><div class="line">    cIOrdId_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::orderId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a3ac247d4654e2a2f78d192c964337073">OrderID</a> value)</div><div class="line">{</div><div class="line">    orderId_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::price(UInt64 value)</div><div class="line">{</div><div class="line">    price_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::orderQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value)</div><div class="line">{</div><div class="line">    orderQty_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::minQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value)</div><div class="line">{</div><div class="line">    minQty_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::leavesQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value)</div><div class="line">{</div><div class="line">    leavesQty_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::cumQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a103b394eb61a62f23886e5ba7088c274">Quantity</a> value)</div><div class="line">{</div><div class="line">    cumQty_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::securityId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a654231565949f4ec9201c4b7ba2bb5a7">SecurityID</a> value)</div><div class="line">{</div><div class="line">    securityId_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::side(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1Side.html#a8150b7776c2a1749101acf22e868d091">Side::Enum</a> value)</div><div class="line">{</div><div class="line">    side_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::ordType(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091">OrdType::Enum</a> value)</div><div class="line">{</div><div class="line">    ordType_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::stopPx(Int64 value)</div><div class="line">{</div><div class="line">    stopPx_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::timeInForce(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1TimeInForce.html#a8150b7776c2a1749101acf22e868d091">TimeInForce::Enum</a> value)</div><div class="line">{</div><div class="line">    timeInForce_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::expireDate(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a1ce830b8d7e3e57e5d44498eae99355d">LocalMktDate</a> value)</div><div class="line">{</div><div class="line">    expireDate_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::orderStatus(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdStatus.html#a8150b7776c2a1749101acf22e868d091">OrdStatus::Enum</a> value)</div><div class="line">{</div><div class="line">    orderStatus_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::lastPx(Int64 value)</div><div class="line">{</div><div class="line">    lastPx_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">Order&amp; Order::transactTime(UInt64 value)</div><div class="line">{</div><div class="line">    transactTime_ = value;</div><div class="line">    <span class="keywordflow">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>MessageFactory.h <a class="anchor" id="message-factory-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../Common/Helpers.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;Order.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples {</div><div class="line"></div><div class="line"><span class="comment">// Constructs SBE messages of specific types according to the given parameters.</span></div><div class="line"><span class="keyword">class </span>MessageFactory</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="keyword">explicit</span> MessageFactory(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a8c224e2bbeebdc910c71d05105499012">MarketSegmentID</a> marketSegmentId);</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable NewOrderSingle message according to the given order traits.</span></div><div class="line">    NewOrderSingle &amp; getNewOrder(<span class="keyword">const</span> Order&amp; order) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable OrderCancelReplaceRequest message for the given order.</span></div><div class="line">    OrderCancelReplaceRequest &amp; getModifyRequest(<span class="keyword">const</span> Order&amp; order) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable OrderCancelRequest message for the given order.</span></div><div class="line">    OrderCancelRequest &amp; getCancelRequest(<span class="keyword">const</span> Order&amp; order) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable NewOrderCross message according to the given order traits.</span></div><div class="line">    NewOrderCross &amp; getNewOrderCross(<span class="keyword">const</span> Order&amp; buySideOrder, <span class="keyword">const</span> Order&amp; sellSideOrder) <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable OrderMassActionRequest message.</span></div><div class="line">    OrderMassActionRequest &amp; getOrderMassActionRequest() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Constructs a reusable SecurityDefinitionRequest message.</span></div><div class="line">    SecurityDefinitionRequest &amp; getSecurityDefinitionRequest() <span class="keyword">const</span>;</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    NewOrderSingle initNewOrder() <span class="keyword">const</span>;</div><div class="line">    OrderCancelReplaceRequest initOrderCancelReplaceRequest() <span class="keyword">const</span>;</div><div class="line">    OrderCancelRequest initOrderCancelRequest() <span class="keyword">const</span>;</div><div class="line">    NewOrderCross initNewOrderCross() <span class="keyword">const</span>;</div><div class="line">    OrderMassActionRequest initOrderMassActionRequest() <span class="keyword">const</span>;</div><div class="line">    SecurityDefinitionRequest initSecurityDefinitionRequest() <span class="keyword">const</span>;</div><div class="line"></div><div class="line">    InvestorID iid_;</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a8c224e2bbeebdc910c71d05105499012">MarketSegmentID</a> marketSegmentId_;</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>MessageFactory.cpp <a class="anchor" id="message-factory-cpp"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../Settings/Defaults.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;MessageFactory.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples {</div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* Location = <span class="stringliteral">&quot;DMA&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* EnteringTrader = <span class="stringliteral">&quot;TADA&quot;</span>;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* DeskId = <span class="stringliteral">&quot;1&quot;</span>;</div><div class="line"><span class="keyword">const</span> <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#aeab490cf83954ff55d4c6fa1c7aec4d8">OrdTagID</a> OrderTag = 100;</div><div class="line"><span class="keyword">const</span> <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a9508e39ede077483ac7209337604b173">Account</a> <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a9508e39ede077483ac7209337604b173">Account</a> = 10101;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> MessageType&gt;</div><div class="line"><span class="keywordtype">void</span> setMarketSegmentId(MessageType &amp; msg, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a8c224e2bbeebdc910c71d05105499012">MarketSegmentID</a> marketSegmentId)</div><div class="line">{</div><div class="line">    msg-&gt;businessHeader().setMarketSegmentId(marketSegmentId);</div><div class="line">}</div><div class="line"></div><div class="line">MessageFactory::MessageFactory(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a8c224e2bbeebdc910c71d05105499012">MarketSegmentID</a> marketSegmentId)</div><div class="line">{</div><div class="line">    iid_.setPrefix(300);</div><div class="line">    iid_.setDocument(123456);</div><div class="line">    marketSegmentId_ = marketSegmentId;</div><div class="line">}</div><div class="line"></div><div class="line">NewOrderSingle MessageFactory::initNewOrder()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    NewOrderSingle msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;setOrdTagId(OrderTag)</div><div class="line">        .setMmProtectionReset(Boolean::FalseValue)</div><div class="line">        .setSenderLocation(Location)</div><div class="line">        .setEnteringTrader(EnteringTrader)</div><div class="line">        .setSelfTradePreventionInstruction(SelfTradePreventionInstruction::None)</div><div class="line">        .setMemo(<span class="stringliteral">&quot;ONIXS 123456789&quot;</span>)</div><div class="line">        .setDeskId(DeskId)</div><div class="line">        .setAccount(Account)</div><div class="line">        .setInvestorId(iid_);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">NewOrderSingle &amp; MessageFactory::getNewOrder(<span class="keyword">const</span> Order&amp; order)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> NewOrderSingle msg = initNewOrder();</div><div class="line"></div><div class="line">    msg-&gt;setPrice(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a750d723da4f23886b35bc6d2bdeb4f34">PriceOptional</a>(order.price_))</div><div class="line">        .setOrderQty(order.orderQty_)</div><div class="line">        .setSecurityId(order.securityId_)</div><div class="line">        .setClOrdId(order.cIOrdId_)</div><div class="line">        .setStopPx(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a750d723da4f23886b35bc6d2bdeb4f34">PriceOptional</a>(order.stopPx_))</div><div class="line">        .setMinQty(order.minQty_)</div><div class="line">        .setOrdType(order.ordType_)</div><div class="line">        .setTimeInForce(order.timeInForce_)</div><div class="line">        .setSide(order.side_);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (order.timeInForce_ == TimeInForce::GoodTillDate)</div><div class="line">        msg-&gt;setExpireDate(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a215dff2462e661d28d4d2e681d9add6d">localMktDateToTimestamp</a>(order.expireDate_));</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderCancelReplaceRequest MessageFactory::initOrderCancelReplaceRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    OrderCancelReplaceRequest msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;setOrdTagId(OrderTag)</div><div class="line">        .setMmProtectionReset(Boolean::FalseValue)</div><div class="line">        .setSenderLocation(Location)</div><div class="line">        .setEnteringTrader(EnteringTrader)</div><div class="line">        .setSelfTradePreventionInstruction(SelfTradePreventionInstruction::None)</div><div class="line">        .setMemo(<span class="stringliteral">&quot;ONIXS 123456789&quot;</span>)</div><div class="line">        .setInvestorId(iid_)</div><div class="line">        .setAccount(Account)</div><div class="line">        .setDeskId(DeskId);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderCancelReplaceRequest &amp; MessageFactory::getModifyRequest(<span class="keyword">const</span> Order&amp; order)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> OrderCancelReplaceRequest msg = initOrderCancelReplaceRequest();</div><div class="line"></div><div class="line">    msg-&gt;setPrice(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a750d723da4f23886b35bc6d2bdeb4f34">PriceOptional</a>(order.price_))</div><div class="line">        .setOrderQty(order.orderQty_)</div><div class="line">        .setSecurityId(order.securityId_)</div><div class="line">        .setClOrdId(order.cIOrdId_)</div><div class="line">        .setOrderId(order.orderId_)</div><div class="line">        .setStopPx(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a750d723da4f23886b35bc6d2bdeb4f34">PriceOptional</a>(order.stopPx_))</div><div class="line">        .setMinQty(order.minQty_)</div><div class="line">        .setOrdType(order.ordType_)</div><div class="line">        .setTimeInForce(order.timeInForce_)</div><div class="line">        .setSide(order.side_);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (order.timeInForce_ == TimeInForce::GoodTillDate)</div><div class="line">        msg-&gt;setExpireDate(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a215dff2462e661d28d4d2e681d9add6d">localMktDateToTimestamp</a>(order.expireDate_));</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderCancelRequest MessageFactory::initOrderCancelRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    OrderCancelRequest msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;</div><div class="line">        setSenderLocation(Location)</div><div class="line">        .setEnteringTrader(EnteringTrader)</div><div class="line">        .setMemo(<span class="stringliteral">&quot;ONIXS 123456789&quot;</span>)</div><div class="line">        .setDeskId(DeskId);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderCancelRequest &amp; MessageFactory::getCancelRequest(<span class="keyword">const</span> Order&amp; order)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> OrderCancelRequest msg = initOrderCancelRequest();</div><div class="line"></div><div class="line">    msg-&gt;setClOrdId(order.cIOrdId_)</div><div class="line">        .setOrderId(order.orderId_)</div><div class="line">        .setSecurityId(order.securityId_)</div><div class="line">        .setSide(order.side_)</div><div class="line">        ;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">NewOrderCross MessageFactory::initNewOrderCross()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    NewOrderCross msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;</div><div class="line">        setSenderLocation(Location)</div><div class="line">        .setEnteringTrader(EnteringTrader)</div><div class="line">        .setMemo(<span class="stringliteral">&quot;ONIXS 123456789&quot;</span>)</div><div class="line">        .setCrossPrioritization(CrossPrioritization::None)</div><div class="line">        .setDeskId(DeskId)</div><div class="line">        ;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">NewOrderCross &amp; MessageFactory::getNewOrderCross(<span class="keyword">const</span> Order&amp; buySideOrder, <span class="keyword">const</span> Order&amp; sellSideOrder)<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> NewOrderCross msg = initNewOrderCross();</div><div class="line"></div><div class="line">    msg-&gt;setPrice(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a750d723da4f23886b35bc6d2bdeb4f34">PriceOptional</a>(buySideOrder.price_))</div><div class="line">        .setSecurityId(buySideOrder.securityId_)</div><div class="line">        .setOrderQty(buySideOrder.orderQty_)</div><div class="line">        .setCrossId(IdGenerator::newId())</div><div class="line">        ;</div><div class="line"></div><div class="line">    NewOrderCross106::Sides sides = msg-&gt;sides(2);</div><div class="line"></div><div class="line">    NewOrderCross106::SidesEntry buyEntry = sides[0];</div><div class="line">    NewOrderCross106::SidesEntry sellEntry = sides[1];</div><div class="line"></div><div class="line">    buyEntry.setClOrdId(buySideOrder.cIOrdId_)</div><div class="line">            .setSide(buySideOrder.side_)</div><div class="line">            .setAccount(Account);</div><div class="line"></div><div class="line">    sellEntry.setClOrdId(sellSideOrder.cIOrdId_)</div><div class="line">             .setSide(sellSideOrder.side_)</div><div class="line">             .setAccount(Account);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderMassActionRequest MessageFactory::initOrderMassActionRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    OrderMassActionRequest msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;setOrdTagId(OrderTag)</div><div class="line">        .setMassActionScope(MassActionScope::AllOrdersForATradingSession)</div><div class="line">        .setMassActionType(MassActionType::CancelOrders)</div><div class="line">        .setInvestorId(iid_);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">OrderMassActionRequest &amp; MessageFactory::getOrderMassActionRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> OrderMassActionRequest msg = initOrderMassActionRequest();</div><div class="line"></div><div class="line">    msg-&gt;setClOrdId(IdGenerator::newId());</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">SecurityDefinitionRequest MessageFactory::initSecurityDefinitionRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    SecurityDefinitionRequest msg;</div><div class="line"></div><div class="line">    setMarketSegmentId(msg, marketSegmentId_);</div><div class="line"></div><div class="line">    msg-&gt;</div><div class="line">        setSenderLocation(Location)</div><div class="line">        .setEnteringTrader(EnteringTrader);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">SecurityDefinitionRequest &amp; MessageFactory::getSecurityDefinitionRequest()<span class="keyword"> const</span></div><div class="line"><span class="keyword"></span>{</div><div class="line">    <span class="keyword">static</span> SecurityDefinitionRequest msg = initSecurityDefinitionRequest();</div><div class="line"></div><div class="line">    msg-&gt;setSecurityReqId(IdGenerator::newId());</div><div class="line"></div><div class="line">    SecurityDefinitionRequest300::Legs legs = msg-&gt;legs(1);</div><div class="line"></div><div class="line">    legs[0]</div><div class="line">        .setLegSymbol(<span class="stringliteral">&quot;GOAU3&quot;</span>)</div><div class="line">        .setLegRatioQty(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a59284133bd745adfd95e97114fc97ce2">RatioQty</a>(1));</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>TradingClient.h <a class="anchor" id="trading-client-h"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Session_8h.html">OnixS/B3/BOE/Session.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;MessageFactory.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;CUI.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Order.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;Book.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line"><span class="comment">// Sample console-based trading client which sends orders to counterparty</span></div><div class="line"><span class="comment">// allows modifying and canceling them. It also handles all other issues</span></div><div class="line"><span class="comment">// like handling messages from the counterparty.</span></div><div class="line"><span class="keyword">class </span>TradingClient <a class="code" href="Compiler_8h.html#a57909da9e9e06842990c932680324118">ONIXS_B3_BOE_FINAL</a> : <span class="keyword">private</span> SessionListener</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Initializes the client with a given behavior.</span></div><div class="line">    <span class="keyword">explicit</span> TradingClient(<span class="keyword">const</span> Settings&amp; settings);</div><div class="line"></div><div class="line">    <span class="comment">// Performs trading by processing user requests.</span></div><div class="line">    <span class="keywordtype">void</span> run();</div><div class="line"></div><div class="line"><span class="keyword">private</span>:</div><div class="line">    <span class="comment">// Set of control parameters that affect trading.</span></div><div class="line">    <span class="keyword">const</span> Settings&amp; settings_;</div><div class="line"></div><div class="line">    <span class="comment">// Primary BOE session with the counterparty.</span></div><div class="line">    PtrTraits&lt;Session&gt;::UniquePtr session_;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> connected_;</div><div class="line"></div><div class="line">    <span class="comment">// Store of orders sent to the counterparty.</span></div><div class="line">    Book&lt;Order&gt; orderBook_;</div><div class="line">    <span class="keyword">typedef</span> Book&lt;Order&gt;::EntryList OrderList;</div><div class="line"></div><div class="line">    <span class="comment">// Creates SBE messages to be sent to the counterparty.</span></div><div class="line">    MessageFactory messageFactory_;</div><div class="line"></div><div class="line">    <span class="comment">// UI-specific part of the trading client.</span></div><div class="line">    <span class="keyword">typedef</span> CUI::Menu&lt;TradingClient&gt; Menu;</div><div class="line"></div><div class="line">    Menu menu_;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> constructMenu();</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> createSessions();</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> processSendSequence(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processExit(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processOrderCancelRequest(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processOrderMassActionRequest(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processOrderModifyRequest(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processSendNewOrder(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processViewOrders(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processViewSessions(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processSecurityDefinitionRequest(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processCrossOrder(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> resetSequenceNumbers(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processEstablishConnection(CUI::CommandExecutionStatus*);</div><div class="line">    <span class="keywordtype">void</span> processDisconnect(CUI::CommandExecutionStatus*);</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> checkSessionConnected();</div><div class="line"></div><div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> SbeMessageType, <span class="keywordtype">size_t</span> MaxMessageSize, <span class="keyword">typename</span> MessageInitializer&gt;</div><div class="line">    <span class="keywordtype">void</span> send(Messaging::MessageHolder&lt;SbeMessageType, MaxMessageSize, MessageInitializer&gt; &amp;msg);</div><div class="line"></div><div class="line">    Order* findByOrderId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> clOrdId);</div><div class="line">    Order newOrder();</div><div class="line"></div><div class="line">    <span class="comment">// Listener part.</span></div><div class="line">    <span class="keywordtype">void</span> onMessageSending(<span class="keywordtype">char</span>* bytes, <span class="keywordtype">size_t</span> size, Session*) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onNegotiateResponse(const NegotiateResponse2 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onNegotiateReject(const NegotiateReject3 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onEstablishAck(const EstablishAck5 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onEstablishReject(const EstablishReject6 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onSequence(const Sequence9 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onTerminate(const Terminate7 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onRetransmitReject(const Messaging::RetransmitReject14 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onRetransmission(const Messaging::Retransmission13 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onNotApplied(const Messaging::NotApplied8 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onBusinessMessageReject(const BusinessMessageReject206 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onExecutionReportNew(const ExecutionReportNew200 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onExecutionReportModify(const ExecutionReportModify201 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onExecutionReportCancel(const ExecutionReportCancel202 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onExecutionReportTrade(const ExecutionReportTrade203 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onExecutionReportReject(const ExecutionReportReject204 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onSecurityDefinitionResponse(const SecurityDefinitionResponse301 &amp; msg, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onOrderMassActionReport(const OrderMassActionReport702&amp; msg, Session* sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onStateChange(SessionStateId::Enum newState, SessionStateId::Enum prevState, Session * sn) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onError(SessionErrorReason::Enum reason, const <a class="code" href="namespacestd.html">std</a>::<span class="keywordtype">string</span> &amp; description, Session * sn, Messaging::SbeMessage) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">    <span class="keywordtype">void</span> onWarning(SessionWarningReason::Enum reason, const <a class="code" href="namespacestd.html">std</a>::<span class="keywordtype">string</span> &amp; description, Session * sn, Messaging::SbeMessage) ONIXS_B3_BOE_OVERRIDE;</div><div class="line">};</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>TradingClient.cpp <a class="anchor" id="trading-client-cpp"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;../Settings/Defaults.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;TradingClient.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>Samples</div><div class="line">{</div><div class="line">Session* createSession(</div><div class="line">    <span class="keyword">const</span> SessionSettings&amp; settings, SessionListener* listener,</div><div class="line">    UInt64 sessionVerId = Session::UndefinedSessionVerID, <span class="keyword">const</span> std::string&amp; customKey = <span class="stringliteral">&quot;&quot;</span>)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> Session(settings, listener, SessionStorageType::FileBased, <a class="code" href="Compiler_8h.html#a7aebce3454c06095b826f378c1fa860b">ONIXS_B3_BOE_NULLPTR</a>, sessionVerId, customKey);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MsgType&gt;</div><div class="line"><span class="keywordtype">bool</span> isRetransmitted(<span class="keyword">const</span> MsgType&amp; msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> msg.businessHeader().eventIndicator().possResend();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MsgType&gt;</div><div class="line"><span class="keywordtype">void</span> setCommonFields(Order * order, <span class="keyword">const</span> MsgType&amp; msg)</div><div class="line">{</div><div class="line">    order-&gt;</div><div class="line">         orderQty(msg.orderQty())</div><div class="line">        .securityId(msg.securityId())</div><div class="line">        .transactTime(msg.transactTime().time());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;&gt;</div><div class="line"><span class="keywordtype">void</span> setCommonFields&lt;ExecutionReportReject204&gt;(Order * order, <span class="keyword">const</span> ExecutionReportReject204 &amp; msg)</div><div class="line">{</div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a7df5b61fdd93600e68b67f2c5c8251b3">QuantityOptional</a> orderQty;</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(msg.orderQty(orderQty))</div><div class="line">        order-&gt;orderQty(orderQty);</div><div class="line"></div><div class="line">    order-&gt;</div><div class="line">        securityId(msg.securityId())</div><div class="line">        .transactTime(msg.transactTime().time());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MsgType&gt;</div><div class="line"><span class="keywordtype">void</span> setExpireDate(Order * order, <span class="keyword">const</span> MsgType&amp; msg)</div><div class="line">{</div><div class="line">    Timestamp expireDate;</div><div class="line">    <span class="keywordflow">if</span>(msg.expireDate(expireDate))</div><div class="line">        order-&gt;expireDate_ = <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a07a46ee2db9e8852b47778943737800d">timestampToLocalMktDate</a>(expireDate);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> MsgType&gt;</div><div class="line"><span class="keywordtype">void</span> setOrdStatus(OrdStatus::Enum &amp; ordStatus, <span class="keyword">const</span> MsgType&amp; msg)</div><div class="line">{</div><div class="line">    ordStatus = msg.ordStatus();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span>CUI;</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> ListViewer&lt;Order&gt; OrdersViewer;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SbeMessageType, <span class="keywordtype">size_t</span> MaxMessageSize, <span class="keyword">typename</span> MessageInitializer&gt;</div><div class="line"><span class="keywordtype">void</span> TradingClient::send(Messaging::MessageHolder&lt;SbeMessageType, MaxMessageSize, MessageInitializer&gt; &amp;msg)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    session_-&gt;send(msg);</div><div class="line">}</div><div class="line"></div><div class="line">Order* TradingClient::findByOrderId(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a125a9fd588467f415fb74bbb3930b396">ClOrdID</a> clOrdId)</div><div class="line">{</div><div class="line">    Order* <span class="keyword">const</span> msg = orderBook_.find(clOrdId);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!msg)</div><div class="line">    {</div><div class="line">        std::stringstream ss;</div><div class="line">        ss</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Cannot process received Execution Report. No order was sent with ClOrdID (tag = 11) equal to &#39;&quot;</span></div><div class="line">            &lt;&lt; clOrdId</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot; in the current session&#39;&quot;</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">throw</span> std::domain_error(ss.str());</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> msg;</div><div class="line">}</div><div class="line"></div><div class="line">TradingClient::TradingClient(<span class="keyword">const</span> Settings&amp; settings)</div><div class="line">    : settings_(settings)</div><div class="line">    , connected_(false)</div><div class="line">    , messageFactory_(atoi(settings.get(<span class="stringliteral">&quot;MarketSegment&quot;</span>).c_str()))</div><div class="line">    , menu_(this)</div><div class="line">{</div><div class="line">    createSessions();</div><div class="line">    constructMenu();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::run()</div><div class="line">{</div><div class="line">    menu_.processRequests();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::constructMenu()</div><div class="line">{</div><div class="line">    menu_</div><div class="line">        .add(<span class="stringliteral">&quot;Connect Sessions.&quot;</span>, <span class="stringliteral">&quot;Sending Negotiation/Establishment.. &quot;</span>, &amp;TradingClient::processEstablishConnection)</div><div class="line">        .add(<span class="stringliteral">&quot;Review the status of sessions. &quot;</span>, <span class="stringliteral">&quot;Viewing the status of sessions.. &quot;</span>, &amp;TradingClient::processViewSessions)</div><div class="line">        .add(<span class="stringliteral">&quot;Send Sequence. &quot;</span>, <span class="stringliteral">&quot;Sending Sequence.. &quot;</span>, &amp;TradingClient::processSendSequence)</div><div class="line">        .add(<span class="stringliteral">&quot;Review sent orders and their status. &quot;</span>, <span class="stringliteral">&quot;Viewing sent orders and their status.. &quot;</span>, &amp;TradingClient::processViewOrders)</div><div class="line">        .add(<span class="stringliteral">&quot;Create and send a New Order. &quot;</span>, <span class="stringliteral">&quot;Creating new order.. &quot;</span>, &amp;TradingClient::processSendNewOrder)</div><div class="line">        .add(<span class="stringliteral">&quot;Submit Order Modify Request. &quot;</span>, <span class="stringliteral">&quot;Order Modify Request.. &quot;</span>, &amp;TradingClient::processOrderModifyRequest)</div><div class="line">        .add(<span class="stringliteral">&quot;Submit Order Cancel Request. &quot;</span>, <span class="stringliteral">&quot;Order Cancel Request.. &quot;</span>, &amp;TradingClient::processOrderCancelRequest)</div><div class="line">        .add(<span class="stringliteral">&quot;Submit Order Mass Action Request. &quot;</span>, <span class="stringliteral">&quot;Order Mass Action Request.. &quot;</span>, &amp;TradingClient::processOrderMassActionRequest)</div><div class="line">        .add(<span class="stringliteral">&quot;Submit SecurityDefinitionRequest. &quot;</span>, <span class="stringliteral">&quot;Creating SecurityDefinition.. &quot;</span>, &amp;TradingClient::processSecurityDefinitionRequest)</div><div class="line">        .add(<span class="stringliteral">&quot;Submit New Order Cross. &quot;</span>, <span class="stringliteral">&quot;Creating Cross Order.. &quot;</span>, &amp;TradingClient::processCrossOrder)</div><div class="line">        .add(<span class="stringliteral">&quot;Disconnect all sessions&quot;</span>, <span class="stringliteral">&quot;Closing connections...&quot;</span>, &amp;TradingClient::processDisconnect)</div><div class="line">        .add(<span class="stringliteral">&quot;Reset Sequence Numbers&quot;</span>, <span class="stringliteral">&quot;Reset Sequence Numbers&quot;</span>, &amp;TradingClient::resetSequenceNumbers)</div><div class="line">        .add(<span class="stringliteral">&quot;Close the connection and exit. &quot;</span>, <span class="stringliteral">&quot;Exiting application.. &quot;</span>, &amp;TradingClient::processExit);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">bool</span> TradingClient::checkSessionConnected()</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!connected_)</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Session is not connected. Please establish the connection first.&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> connected_;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::createSessions()</div><div class="line">{</div><div class="line">    <span class="comment">// 1. Creates session according to the application settings.</span></div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Creating the primary BOE Session..&quot;</span>);</div><div class="line"></div><div class="line">    SessionSettings settings;</div><div class="line"></div><div class="line">    settings</div><div class="line">        .licenseStore(<span class="stringliteral">&quot;../../license&quot;</span>)</div><div class="line">        .sessionId(settings_.getAsInt(<span class="stringliteral">&quot;SessionId&quot;</span>))</div><div class="line">        .accessKey(settings_.get(<span class="stringliteral">&quot;AccessKey&quot;</span>))</div><div class="line">        .enteringFirm(settings_.getAsInt(<span class="stringliteral">&quot;FirmId&quot;</span>))</div><div class="line">        .tradingSystemName(settings_.get(<span class="stringliteral">&quot;TradingSystemName&quot;</span>))</div><div class="line">        .tradingSystemVersion(settings_.get(<span class="stringliteral">&quot;TradingSystemVersion&quot;</span>))</div><div class="line">        .keepAliveInterval(settings_.getAsInt(<span class="stringliteral">&quot;KeepAliveInterval&quot;</span>));</div><div class="line"></div><div class="line">    session_.reset(createSession(settings, <span class="keyword">this</span>));</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> incomingSequenceNumber = settings_.getAsInt(<span class="stringliteral">&quot;InSeqNum&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (incomingSequenceNumber &gt; 0)</div><div class="line">        session_-&gt;inSeqNum(incomingSequenceNumber);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> outgoingSequenceNumber = settings_.getAsInt(<span class="stringliteral">&quot;OutSeqNum&quot;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (outgoingSequenceNumber &gt; 0)</div><div class="line">        session_-&gt;outSeqNum(outgoingSequenceNumber);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Menu actions</span></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processEstablishConnection(CommandExecutionStatus* status)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!connected_)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">try</span></div><div class="line">        {</div><div class="line">            session_-&gt;connect(settings_.get(<span class="stringliteral">&quot;Host&quot;</span>), settings_.getAsInt(<span class="stringliteral">&quot;Port&quot;</span>));</div><div class="line">        }</div><div class="line">        <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex)</div><div class="line">        {</div><div class="line">            Screen::info(<span class="stringliteral">&quot;Cannot connect to the host: &quot;</span>, ex.what());</div><div class="line">        }</div><div class="line"></div><div class="line">        Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        Screen::info(<span class="stringliteral">&quot;Connection is already established.&quot;</span>);</div><div class="line"></div><div class="line">    *status = ContinueExecution;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processDisconnect(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="Compiler_8h.html#a7aebce3454c06095b826f378c1fa860b">ONIXS_B3_BOE_NULLPTR</a> != session_.get() &amp;&amp; session_-&gt;state() != <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a8150b7776c2a1749101acf22e868d091a84ab0fbbb76a8c897feb1cd806d56443">SessionStateId::Disconnected</a>)</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Disconnecting from primary counterparty.. &quot;</span>);</div><div class="line"></div><div class="line">        session_-&gt;disconnect();</div><div class="line">    }</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processSendSequence(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    session_-&gt;sendSequenceMessage();</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processViewOrders(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    OrderList orderList;</div><div class="line">    orderBook_.getEntries(orderList);</div><div class="line">    OrdersViewer::outputItems(orderList, 10);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processViewSessions(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Primary BOE session: &quot;</span>,</div><div class="line">                 session_-&gt;toString() + <span class="stringliteral">&quot;, State=&quot;</span> + <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a192974cf7e6c77a89eeb0f355dc1896b">SessionStateId::toString</a>(session_-&gt;state()) +</div><div class="line">                 <span class="stringliteral">&quot;.&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processOrderMassActionRequest(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Sending Order Mass Action Request to counterparty.. &quot;</span>);</div><div class="line"></div><div class="line">    OrderMassActionRequest &amp; msg = messageFactory_.getOrderMassActionRequest();</div><div class="line"></div><div class="line">    send(msg);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processSecurityDefinitionRequest(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Sending Security Definition Request to counterparty.. &quot;</span>);</div><div class="line"></div><div class="line">    SecurityDefinitionRequest &amp; msg = messageFactory_.getSecurityDefinitionRequest();</div><div class="line"></div><div class="line">    send(msg);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processSendNewOrder(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Sending new order to counterparty.. &quot;</span>);</div><div class="line"></div><div class="line">    Order order = newOrder();</div><div class="line"></div><div class="line">    NewOrderSingle &amp; msg = messageFactory_.getNewOrder(order);</div><div class="line"></div><div class="line">    send(msg);</div><div class="line">    orderBook_.store(order);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processOrderCancelRequest(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    OrderList ordersInBook;</div><div class="line">    orderBook_.getEntries(ordersInBook);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ordersInBook.empty())</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;No orders found&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    OrdersViewer orderViewer;</div><div class="line">    orderViewer.outputItems(ordersInBook, 10);</div><div class="line"></div><div class="line">    Screen::out(<span class="stringliteral">&quot;Enter the index of the order to be canceled &quot;</span>);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> orderIndex = atoi(Screen::getInput().c_str());</div><div class="line"></div><div class="line">    <span class="keyword">const</span> Order * order = ordersInBook.at(orderIndex - 1);</div><div class="line"></div><div class="line">    OrderCancelRequest &amp; msg = messageFactory_.getCancelRequest(*order);</div><div class="line"></div><div class="line">    send(msg);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processOrderModifyRequest(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    OrderList ordersInBook;</div><div class="line">    orderBook_.getEntries(ordersInBook);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (ordersInBook.empty())</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;No orders found&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    OrdersViewer orderViewer;</div><div class="line">    orderViewer.outputItems(ordersInBook, 10);</div><div class="line"></div><div class="line">    Screen::out(<span class="stringliteral">&quot;Enter the index of the order to be modified &quot;</span>);</div><div class="line"></div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">int</span> orderIndex = atoi(Screen::getInput().c_str());</div><div class="line"></div><div class="line">    Order* <span class="keyword">const</span> order = ordersInBook.at(orderIndex - 1);</div><div class="line"></div><div class="line">    <span class="comment">// Changing OrderQty</span></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter new OrderQty (or Enter to skip): &quot;</span>);</div><div class="line">    Screen::getInput(order-&gt;orderQty_, order-&gt;orderQty_);</div><div class="line"></div><div class="line">    <span class="comment">// Changing Price</span></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter new Price mantissa (or Enter to skip): &quot;</span>);</div><div class="line">    Screen::getInput(order-&gt;price_, order-&gt;price_);</div><div class="line"></div><div class="line">    OrderCancelReplaceRequest &amp; msg = messageFactory_.getModifyRequest(*order);</div><div class="line"></div><div class="line">    send(msg);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processCrossOrder(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!checkSessionConnected())</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order buySideOrder;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter Price mantissa (default = &quot;</span> + <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(DefaultPriceMantissa) + <span class="stringliteral">&quot;): &quot;</span>);</div><div class="line">    Screen::getInput(buySideOrder.price_, DefaultPriceMantissa);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter SecurityId (default=&quot;</span> + <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(DefaultSecurityId) + <span class="stringliteral">&quot;): &quot;</span>);</div><div class="line">    Screen::getInput(buySideOrder.securityId_, DefaultSecurityId);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter Quantity (default = 100): &quot;</span>);</div><div class="line">    Screen::getInput&lt;QuantityOptional&gt;(buySideOrder.orderQty_, 100ul);</div><div class="line"></div><div class="line">    Order sellSideOrder;</div><div class="line"></div><div class="line">    sellSideOrder</div><div class="line">        .price(buySideOrder.price_)</div><div class="line">        .securityId(buySideOrder.securityId_)</div><div class="line">        .orderQty(buySideOrder.orderQty_)</div><div class="line">        .side(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1Side.html#a8150b7776c2a1749101acf22e868d091a7d1cf6eeceff519662debc0e877e8f46">Side::Sell</a>);</div><div class="line"></div><div class="line">    NewOrderCross &amp; msg = messageFactory_.getNewOrderCross(buySideOrder, sellSideOrder);</div><div class="line"></div><div class="line">    send(msg);</div><div class="line"></div><div class="line">    orderBook_</div><div class="line">        .store(buySideOrder)</div><div class="line">        .store(sellSideOrder);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::processExit(CommandExecutionStatus* status)</div><div class="line">{</div><div class="line">    *status = TerminateExecution;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::resetSequenceNumbers(CommandExecutionStatus*)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="Compiler_8h.html#a7aebce3454c06095b826f378c1fa860b">ONIXS_B3_BOE_NULLPTR</a> != session_.get() &amp;&amp; session_-&gt;state() == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a8150b7776c2a1749101acf22e868d091a84ab0fbbb76a8c897feb1cd806d56443">SessionStateId::Disconnected</a>)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span>(session_-&gt;negotiated())</div><div class="line">            session_-&gt;reset();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">        Screen::info(<span class="stringliteral">&quot;Operation can be performed only when the sessions are disconnected&quot;</span>);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Done&quot;</span>);</div><div class="line">}</div><div class="line"></div><div class="line">Order TradingClient::newOrder()</div><div class="line">{</div><div class="line">    Order order;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter SecurityId (default=&quot;</span> + <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(DefaultSecurityId) + <span class="stringliteral">&quot;): &quot;</span>);</div><div class="line">    Screen::getInput(order.securityId_, DefaultSecurityId);</div><div class="line"></div><div class="line">    Screen::info(</div><div class="line">        <span class="stringliteral">&quot;Enter OrderType(40) (1 - Market order, 2 - Limit order (default), 3 - Stop order, 4 - Stop - Limit order, K - Market - Limit order): &quot;</span>);</div><div class="line">    Screen::getInputChar(order.ordType_, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091af56596eeef413fc3e293badca7806716">OrdType::Limit</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (order.ordType_ == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091af56596eeef413fc3e293badca7806716">OrdType::Limit</a> || order.ordType_ == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091adf344029b55d10403f4986d990dccde2">OrdType::StopLimit</a>)</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Enter Price mantissa (default = &quot;</span> + <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(DefaultPriceMantissa) + <span class="stringliteral">&quot;): &quot;</span>);</div><div class="line">        Screen::getInput(order.price_, DefaultPriceMantissa);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (order.ordType_ == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091adf344029b55d10403f4986d990dccde2">OrdType::StopLimit</a> || order.ordType_ == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1OrdType.html#a8150b7776c2a1749101acf22e868d091a1d73709e4551dfd1d0c1c425b5b5f728">OrdType::StopLoss</a>)</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Enter StopPx: &quot;</span>);</div><div class="line">        Screen::getInput(order.stopPx_);</div><div class="line">    }</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter OrderQuantity (default = 100): &quot;</span>);</div><div class="line">    Screen::getInput&lt;QuantityOptional&gt;(order.orderQty_, 100ul);</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter MinQty or skip&quot;</span>);</div><div class="line">    Screen::getInput(order.minQty_, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a080b3c32914c32ce7d8d18b59300b97b">NullQuantityOptional</a>().value());</div><div class="line"></div><div class="line">    Screen::info(</div><div class="line">        <span class="stringliteral">&quot;Enter TimeInForce (0 - Day (default), 1 - Good Till Cancel, 3 - Immediate Or Cancel, 6 - Good Till Date): &quot;</span>);</div><div class="line">    Screen::getInputChar(order.timeInForce_, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1TimeInForce.html#a8150b7776c2a1749101acf22e868d091acc305baebd52eb170a0d311eccd1ad5a">TimeInForce::Day</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (order.timeInForce_ == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1TimeInForce.html#a8150b7776c2a1749101acf22e868d091a7796e61d2ba4254fd519ae965f5d9df8">TimeInForce::GoodTillDate</a>)</div><div class="line">    {</div><div class="line">        Screen::info(<span class="stringliteral">&quot;Enter Expire date YYYYMMDD: &quot;</span>);</div><div class="line">        Screen::getInputLocalMktDate(order.expireDate_);</div><div class="line">    }</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Enter Side (1 - Buy (default), 2 - Sell): &quot;</span>);</div><div class="line">    Screen::getInputChar(order.side_, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1Messaging_1_1Side.html#a8150b7776c2a1749101acf22e868d091aa2b4abf39acee132f381e383a936e5d0">Side::Buy</a>);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> order;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onMessageSending(<span class="keywordtype">char</span>* bytes, <span class="keywordtype">size_t</span> size, Session*)</div><div class="line">{</div><div class="line">    Screen::out(<span class="stringliteral">&quot;Outbound message: &quot;</span>, SbeMessage(bytes, static_cast&lt;Messaging::MessageSize&gt;(size)));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onBusinessMessageReject(<span class="keyword">const</span> BusinessMessageReject206 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onNegotiateResponse(<span class="keyword">const</span> NegotiateResponse2 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onNegotiateReject(<span class="keyword">const</span> NegotiateReject3 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onEstablishAck(<span class="keyword">const</span> EstablishAck5 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onEstablishReject(<span class="keyword">const</span> EstablishReject6 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onSequence(<span class="keyword">const</span> Sequence9 &amp;, Session *)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onTerminate(<span class="keyword">const</span> Terminate7 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onRetransmitReject(<span class="keyword">const</span> Messaging::RetransmitReject14 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onRetransmission(<span class="keyword">const</span> Messaging::Retransmission13 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onNotApplied(<span class="keyword">const</span> Messaging::NotApplied8 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onExecutionReportNew(<span class="keyword">const</span> ExecutionReportNew200 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(isRetransmitted(msg))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order * <span class="keyword">const</span> order = findByOrderId(msg.clOrdId());</div><div class="line">    assert(order);</div><div class="line"></div><div class="line">    setCommonFields(order, msg);</div><div class="line">    setExpireDate(order, msg);</div><div class="line">    setOrdStatus(order-&gt;orderStatus_, msg);</div><div class="line">    order-&gt;orderId_ = msg.clOrdId();</div><div class="line">    order-&gt;timeInForce_ = msg.timeInForce();</div><div class="line">    order-&gt;orderId_ = msg.orderId();</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Order changed: &quot;</span> + order-&gt;toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onExecutionReportModify(<span class="keyword">const</span> ExecutionReportModify201 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(isRetransmitted(msg))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order * <span class="keyword">const</span> order = findByOrderId(msg.clOrdId());</div><div class="line">    assert(order);</div><div class="line"></div><div class="line">    setCommonFields(order, msg);</div><div class="line">    setExpireDate(order, msg);</div><div class="line">    order-&gt;orderId_ = msg.clOrdId();</div><div class="line">    order-&gt;timeInForce_ = msg.timeInForce();</div><div class="line">    order-&gt;orderId_ = msg.orderId();</div><div class="line"></div><div class="line">    setOrdStatus(order-&gt;orderStatus_, msg);</div><div class="line">    order-&gt;leavesQty(msg.leavesQty())</div><div class="line">          .cumQty(msg.cumQty());</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Order changed: &quot;</span> + order-&gt;toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onExecutionReportCancel(<span class="keyword">const</span> ExecutionReportCancel202 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(isRetransmitted(msg))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order * <span class="keyword">const</span> order = findByOrderId(msg.clOrdId());</div><div class="line">    assert(order);</div><div class="line"></div><div class="line">    setCommonFields(order, msg);</div><div class="line">    setExpireDate(order, msg);</div><div class="line">    order-&gt;orderId_ = msg.clOrdId();</div><div class="line">    order-&gt;timeInForce_ = msg.timeInForce();</div><div class="line">    order-&gt;orderId_ = msg.orderId();</div><div class="line"></div><div class="line">    setOrdStatus(order-&gt;orderStatus_, msg);</div><div class="line">    order-&gt;leavesQty(msg.cumQty());</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Order changed: &quot;</span> + order-&gt;toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onExecutionReportReject(<span class="keyword">const</span> ExecutionReportReject204 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(isRetransmitted(msg))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order * <span class="keyword">const</span> order = findByOrderId(msg.clOrdId());</div><div class="line">    assert(order);</div><div class="line"></div><div class="line">    setCommonFields(order, msg);</div><div class="line">    setExpireDate(order, msg);</div><div class="line">    order-&gt;timeInForce_ = msg.timeInForce();</div><div class="line">    setOrdStatus(order-&gt;orderStatus_, msg);</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a284e10dcc63906463e15e556a96d77ff">OrderIDOptional</a> ordId;</div><div class="line">    <span class="keywordflow">if</span>(msg.orderId(ordId))</div><div class="line">        order-&gt;orderId_ = ordId;</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Order changed: &quot;</span> + order-&gt;toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onExecutionReportTrade(<span class="keyword">const</span> ExecutionReportTrade203 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span>(isRetransmitted(msg))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a9fd62c9941423e37132a7d331ad6b643">ClOrdIDOptional</a> clOrdId;</div><div class="line">    <span class="keywordflow">if</span>(!msg.clOrdId(clOrdId))</div><div class="line">        <span class="keywordflow">return</span>;</div><div class="line"></div><div class="line">    Order * <span class="keyword">const</span> order = findByOrderId(clOrdId);</div><div class="line">    assert(order);</div><div class="line"></div><div class="line">    setCommonFields(order, msg);</div><div class="line">    order-&gt;orderId_ = msg.orderId();</div><div class="line">    order-&gt;orderStatus(msg.ordStatus())</div><div class="line">          .orderId(clOrdId)</div><div class="line">          .leavesQty(msg.leavesQty())</div><div class="line">          .cumQty(msg.cumQty())</div><div class="line">          .lastPx(msg.lastPx().mantissa());</div><div class="line"></div><div class="line">    Screen::info(<span class="stringliteral">&quot;Order changed: &quot;</span> + order-&gt;toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onSecurityDefinitionResponse(<span class="keyword">const</span> SecurityDefinitionResponse301 &amp; msg, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Message received from counterparty: &quot;</span>, msg.toString());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onOrderMassActionReport(<span class="keyword">const</span> OrderMassActionReport702&amp; msg, Session*)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Received Order Mass Action Report: &quot;</span>, msg.toString());</div><div class="line">    Screen::info(<span class="stringliteral">&quot;MassActionResponse=&quot;</span>, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(msg.massActionResponse()));</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a5d81481c71b97cb462a5cd587b599e19">SecurityIDOptional</a> securityId = <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a5d81481c71b97cb462a5cd587b599e19">SecurityIDOptional</a>();</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (msg.securityId(securityId))</div><div class="line">        Screen::info(<span class="stringliteral">&quot;MarketSegmentID=&quot;</span>, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE_1_1Messaging.html#a85f066d65ed65d87a4807ccde96dc123">toStr</a>(securityId));</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onStateChange(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a8150b7776c2a1749101acf22e868d091">SessionStateId::Enum</a> newState, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a8150b7776c2a1749101acf22e868d091">SessionStateId::Enum</a> <span class="comment">/*prevState*/</span>, Session *)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Session state changed to &quot;</span>, <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a192974cf7e6c77a89eeb0f355dc1896b">SessionStateId::toString</a>(newState));</div><div class="line">    connected_ = (newState == <a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionStateId.html#a8150b7776c2a1749101acf22e868d091a14dda1f75340d36057f49aabff8603de">SessionStateId::Established</a>);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onError(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionErrorReason.html#a8150b7776c2a1749101acf22e868d091">SessionErrorReason::Enum</a>, <span class="keyword">const</span> std::string &amp; description, Session *, Messaging::SbeMessage)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Session-level error: &quot;</span>, description);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> TradingClient::onWarning(<a class="code" href="structOnixS_1_1B3_1_1BOE_1_1SessionWarningReason.html#a8150b7776c2a1749101acf22e868d091">SessionWarningReason::Enum</a>, <span class="keyword">const</span> std::string &amp; description, Session *, Messaging::SbeMessage)</div><div class="line">{</div><div class="line">    Screen::info(<span class="stringliteral">&quot;Session-level warning: &quot;</span>, description);</div><div class="line">}</div><div class="line"></div><div class="line">}</div></div><!-- fragment --> <h2>Main.cpp <a class="anchor" id="main-cpp"></a></h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;TradingClient.h&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span>Samples;</div><div class="line"></div><div class="line"><span class="keyword">namespace</span></div><div class="line">{</div><div class="line">    <span class="keywordtype">void</span> ensureSettingsAreUpToDate(<span class="keyword">const</span> Settings&amp; appSettings)</div><div class="line">    {</div><div class="line">        <span class="keyword">const</span> std::string upToDateParameter(<span class="stringliteral">&quot;settingsAreUpToDate&quot;</span>);</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (!appSettings.getAsBool(upToDateParameter))</div><div class="line">        {</div><div class="line">            std::string errReason(<span class="stringliteral">&quot;Please update the configuration file (settings.ini) with values received from B3 Support Team and set the &#39;&quot;</span>);</div><div class="line"></div><div class="line">            errReason += upToDateParameter;</div><div class="line"></div><div class="line">            errReason += <span class="stringliteral">&quot;&#39; configuration parameter to &#39;true&#39;&quot;</span>;</div><div class="line"></div><div class="line">            <span class="keywordflow">throw</span> std::domain_error(errReason);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> * argv[])</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;B3 BOE Trading Client sample.&quot;</span> &lt;&lt; std::endl</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0] &lt;&lt; <span class="stringliteral">&quot; {ConfigurationFileName}&quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        std::string configurationFileName = (argc &gt; 1) ? argv[1] : <span class="stringliteral">&quot;settings.ini&quot;</span>;</div><div class="line"></div><div class="line">        Settings settings(configurationFileName);</div><div class="line"></div><div class="line">        ensureSettingsAreUpToDate(settings);</div><div class="line"></div><div class="line">        TradingClient client(settings);</div><div class="line"></div><div class="line">        client.run();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; ex)</div><div class="line">    {</div><div class="line">        std::cerr &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; ex.what() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; std::endl;</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<footer>
<hr class="footer"/>
<address class="footer">
    <small>&copy; <a href="http://www.onixs.biz">Onix Solutions [On<span class="corporate-orange">i</span>x<span class="corporate-orange">S</span>]</a>. All rights reserved.</small>
</address>
</footer>
</div> <!-- wrapper -->
</body>
</html>
