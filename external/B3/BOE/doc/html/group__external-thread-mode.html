<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>OnixS C++ B3 BOE Binary Order Entry: ExternalThread Mode</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="onixs-doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
    $(window).scroll(function() {
        if ($(this).scrollTop() > 1)
        {
            $('header').addClass("sticky");
        }
        else
        {
            $('header').removeClass("sticky");
        }
    });
    </script>
</head>
<body>
<header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
<tbody>
    <tr style="height: 56px;">
        <td id="projectlogo"><a href="http://www.onixs.biz"><img alt="Logo" src="onixs.svg"/></a></td>
        <td style="padding-left: 0.5em;">
            <div id="projectname">OnixS C++ B3 BOE Binary Order Entry
            &#160;<span id="projectnumber">1.3.0</span>
            </div>
            <div id="projectbrief">API Documentation</div>
        </td>
    </tr>
</tbody>
</table>
</div>
</header>
<div id="wrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="modules.html"><span>Contents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ExternalThread Mode</div>  </div>
</div><!--header-->
<div class="contents">
<p>Sometimes, it is more effective to perform the event dispatching in a loop in the main application thread. For this purpose, one can use the <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a> mode.</p>
<h1><a class="anchor" id="stack-creation"></a>
Stack</h1>
<p>Before an externally-managed session is created, the application must create an <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionReactor.html" title="Session&#39;s network stack reactor interface. ">OnixS::B3::BOE::SessionReactor</a> instance. There are two reactor classes, which can be used:</p>
<ul>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpDirectStack.html" title="A high-level wrapper over the TCPDirect network stack. ">OnixS::B3::BOE::TcpDirectStack</a></li>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpStandardStack.html" title="A high-level wrapper over the TCP standard stack. ">OnixS::B3::BOE::TcpStandardStack</a></li>
</ul>
<div class="fragment"><div class="line"></div><div class="line">TcpStandardStack tcpStandardStack;</div><div class="line"></div></div><!-- fragment --><p> The reference to the stack is provided in Session's constructor, for example: </p><div class="fragment"><div class="line"></div><div class="line">Session session(tcpStandardStack, settings, &amp;listener, storageType);</div><div class="line"></div></div><!-- fragment --> <h1><a class="anchor" id="tcpregular-connect-and-disconnect"></a>
Asynchronous Connect and Disconnect</h1>
<p>Applications must call asynchronous Session's methods to connect (<a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ad002fedb18c8762bc2e9623e77b827a1" title="Establishes the connection asynchronously. ">OnixS::B3::BOE::Session::connectAsync</a>) and disconnect (<a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#a53ad730a14769d1b6e71c064581718dc" title="Terminates the connection asynchronously. ">OnixS::B3::BOE::Session::disconnectAsync</a>).</p>
<div class="fragment"><div class="line">session.connectAsync(host, port);</div><div class="line"></div><div class="line"><span class="comment">// Dispatching events..</span></div><div class="line"></div><div class="line">session.disconnectAsync();</div></div><!-- fragment --> <h1><a class="anchor" id="tcpstandard-event-loop"></a>
Dispatching Network Events</h1>
<p>Applications must call <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpStandardStack.html#aff8bdd322c1a92987d20385306711637" title="Processes events on a stack and performs the necessary handling. ">OnixS::B3::BOE::TcpStandardStack::dispatchEvents</a> frequently for each stack that is in use.</p>
<div class="fragment"><div class="line"><span class="keywordtype">bool</span> finished = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"><span class="keywordflow">while</span> (!finished)</div><div class="line">    tcpStandardStack.dispatchEvents();</div><div class="line"></div></div><!-- fragment --> <h1><a class="anchor" id="tcpstandard-stack-shutdown"></a>
Shutdown</h1>
<p>The TCPStandard stack requires finishing all outstanding work and handling all outstanding events. Before destroying the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpStandardStack.html" title="A high-level wrapper over the TCP standard stack. ">OnixS::B3::BOE::TcpStandardStack</a> instance, the following code should be executed: </p><div class="fragment"><div class="line"></div><div class="line"><span class="keywordflow">while</span> (!tcpStandardStack.isQuiescent())</div><div class="line">    tcpStandardStack.dispatchEvents();</div><div class="line"></div></div><!-- fragment --><p> Method <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpStandardStack.html#a2547e3d85d6fc57b795b88d0bd5eb6f4">OnixS::B3::BOE::TcpStandardStack::isQuiescent</a> returns a boolean value indicating whether a stack is quiescent.</p>
<p>This can be used to ensure that all connections have been closed gracefully before destroying a stack (or exiting the application). Destroying a stack while it is not quiescent is permitted by the API, but when doing so there is no guarantee that sent data has been acknowledged by the peer or even transmitted, and there is the possibility that peers' connections will be reset.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__external-thread-mode-sample.html">External Thread Mode Sample</a> </dd>
<dd>
<a class="el" href="group__tcp-standard-benchmark-sample.html">TCPStandard Benchmark Sample</a> </dd>
<dd>
<a class="el" href="group__tcp-direct-getting-started-sample.html">TCPDirect Getting Started Sample</a> </dd>
<dd>
<a class="el" href="group__tcp-direct-benchmark-sample.html">TCPDirect Benchmark Sample</a> </dd></dl>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<footer>
<hr class="footer"/>
<address class="footer">
    <small>&copy; <a href="http://www.onixs.biz">Onix Solutions [On<span class="corporate-orange">i</span>x<span class="corporate-orange">S</span>]</a>. All rights reserved.</small>
</address>
</footer>
</div> <!-- wrapper -->
</body>
</html>
