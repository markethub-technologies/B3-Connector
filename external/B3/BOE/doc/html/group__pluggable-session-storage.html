<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>OnixS C++ B3 BOE Binary Order Entry: Pluggable Session Storage</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="onixs-doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
    $(window).scroll(function() {
        if ($(this).scrollTop() > 1)
        {
            $('header').addClass("sticky");
        }
        else
        {
            $('header').removeClass("sticky");
        }
    });
    </script>
</head>
<body>
<header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
<tbody>
    <tr style="height: 56px;">
        <td id="projectlogo"><a href="http://www.onixs.biz"><img alt="Logo" src="onixs.svg"/></a></td>
        <td style="padding-left: 0.5em;">
            <div id="projectname">OnixS C++ B3 BOE Binary Order Entry
            &#160;<span id="projectnumber">1.3.0</span>
            </div>
            <div id="projectbrief">API Documentation</div>
        </td>
    </tr>
</tbody>
</table>
</div>
</header>
<div id="wrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="modules.html"><span>Contents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Pluggable Session Storage<div class="ingroups"><a class="el" href="group__session-storage.html">Session Storage</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>Pluggable session storage is the storage implemented by the user.</p>
<p>For example, it could be used to implement High-Availability (HA) Solutions:</p>
<p>One can implement a Pluggable Session Storage that stores data to shared storage. If one server fails and another reserve server activates, the Handler can restore session states from the shared storage.</p>
<p>Such storage should implement the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html" title="Session&#39;s storage. ">OnixS::B3::BOE::SessionStorage</a> interface.</p>
<h1><a class="anchor" id="pluggable-storage-implementing"></a>
Implementing Pluggable Storage</h1>
<p>There are a few basic rules that should be applied to the implementation of Pluggable Storage.</p>
<ul>
<li><b>The user should manage the life-cycle of the storage</b>. The Handler treats the instance of a Pluggable Storage as a "foreign" object and never attempts to delete it. On the other hand, there is a strong requirement to keep storage instance valid until the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html" title="A FIXP Session. ">OnixS::B3::BOE::Session</a> instance is destroyed.</li>
<li><b>Be as fast as possible</b>. The Pluggable Storage is a part of the message send/receive path, so it has a direct effect on the sending/receiving latency and overall throughput of the system.</li>
<li><b>Avoid throwing exceptions</b>. Exceptions thrown from Pluggable Storage callbacks immediately break a session.</li>
<li><b>Don't make assumptions about the parameters' life-cycle</b>. Whenever you need to keep such data for separate usage, you should make copies of messages or memory blocks and store them in an appropriate place, but don't keep raw pointers, passed to callbacks.</li>
<li><b>No synchronization is required</b>. The Handler manages all synchronization issues, so all methods of Pluggable Storage are called sequentially.</li>
<li><b>Track message numbers when the message is logged</b>. Message sequence numbers should be tracked while messages are logged, i.e. during <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a4a0897b4b8933af637b4c4b58e36eae1" title="Logs the given inbound message. ">OnixS::B3::BOE::SessionStorage::storeInboundMessage</a> or <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a8c24bdd0687b87e5a3c17878099ccd84" title="Logs the given outgoing message. ">OnixS::B3::BOE::SessionStorage::storeOutboundMessage</a> methods. These numbers should be kept and returned to the Handler through <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a9f1184e89447e961c230e4b5070009cf">OnixS::B3::BOE::SessionStorage::inSeqNum()</a> and <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#adda19e3d0a2e5e991e87f1d05bc0db46">OnixS::B3::BOE::SessionStorage::outSeqNum()</a> calls.</li>
</ul>
<h1><a class="anchor" id="pluggable-storage-call-order"></a>
Call Order of Pluggable Storage Methods</h1>
<p>This section explains how different methods of Pluggable Storage are called in different situations.</p>
<h2><a class="anchor" id="incoming-message-handling"></a>
Incoming message handling</h2>
<ul>
<li>When there is a session-level message, the following methods are called:<ul>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a4a0897b4b8933af637b4c4b58e36eae1" title="Logs the given inbound message. ">OnixS::B3::BOE::SessionStorage::storeInboundMessage</a></li>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html" title="Session&#39;s Listener. ">OnixS::B3::BOE::SessionListener</a> methods, if the listener is present</li>
</ul>
</li>
<li>When there is an application-level message, the call order is reversed:<ul>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html" title="Session&#39;s Listener. ">OnixS::B3::BOE::SessionListener</a> methods, if the listener is present</li>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a4a0897b4b8933af637b4c4b58e36eae1" title="Logs the given inbound message. ">OnixS::B3::BOE::SessionStorage::storeInboundMessage</a>.</li>
</ul>
</li>
</ul>
<p>If the user's code throws an exception on any stage, the session becomes disconnected, and subsequent steps are omitted.</p>
<h2><a class="anchor" id="outgoing-message-handling"></a>
Outgoing message handling</h2>
<ul>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html" title="Session&#39;s Listener. ">OnixS::B3::BOE::SessionListener</a> methods.</li>
<li><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionStorage.html#a8c24bdd0687b87e5a3c17878099ccd84" title="Logs the given outgoing message. ">OnixS::B3::BOE::SessionStorage::storeOutboundMessage</a>.</li>
</ul>
<h1><a class="anchor" id="pluggable-storage-example"></a>
Example</h1>
<div class="fragment"><div class="line"></div><div class="line"><span class="keyword">class </span>MySessionStorage : <span class="keyword">public</span> SessionStorage</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    MySessionStorage();</div><div class="line"></div><div class="line">    <span class="keyword">const</span> std::string&amp; id() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    UInt64 sessionVerId() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> sessionVerId(UInt64 value) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> inSeqNum() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> inSeqNum(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> msgSeqNum) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> outSeqNum() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> outSeqNum(<a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> msgSeqNum) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">bool</span> negotiated() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> negotiated(<span class="keywordtype">bool</span> status) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    Timestamp sessionCreationTime() <span class="keyword">const override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> sessionCreationTime(Timestamp) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> close(<span class="keywordtype">bool</span> doBackup = <span class="keyword">false</span>) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> storeInboundMessage(<span class="keyword">const</span> NetworkMessage&amp; message, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> msgSeqNum, Timestamp messageReceivingUtcTimestamp = Timestamp()) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> storeOutboundMessage(<span class="keyword">const</span> NetworkMessage&amp; message, <a class="code" href="namespaceOnixS_1_1B3_1_1BOE.html#aa553c7020a3846c5c2de098d20c9a0ea">SeqNumber</a> msgSeqNum, Timestamp messageSendingUtcTimestamp = Timestamp()) <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> flush() <span class="keyword">override</span>;</div><div class="line"></div><div class="line">    <span class="keywordtype">void</span> warmup(<span class="keywordtype">size_t</span> messageSize, Timestamp ts) <span class="keyword">override</span>;</div><div class="line">};</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> pluggableStorage()</div><div class="line">{</div><div class="line">    SessionSettings sessionSettings;</div><div class="line"></div><div class="line">    MySessionStorage myStorage;</div><div class="line"></div><div class="line">    Session session(sessionSettings, <span class="keyword">nullptr</span>, SessionStorageType::Pluggable, &amp;myStorage);</div><div class="line">}</div><div class="line"></div></div><!-- fragment --> <dl class="section see"><dt>See also</dt><dd><a class="el" href="group__pluggable-storage-sample.html">Pluggable Storage Sample</a> </dd></dl>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<footer>
<hr class="footer"/>
<address class="footer">
    <small>&copy; <a href="http://www.onixs.biz">Onix Solutions [On<span class="corporate-orange">i</span>x<span class="corporate-orange">S</span>]</a>. All rights reserved.</small>
</address>
</footer>
</div> <!-- wrapper -->
</body>
</html>
