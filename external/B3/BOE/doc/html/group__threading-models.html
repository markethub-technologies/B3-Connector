<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>OnixS C++ B3 BOE Binary Order Entry: Threading Models</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="onixs-doxygen.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">
    $(window).scroll(function() {
        if ($(this).scrollTop() > 1)
        {
            $('header').addClass("sticky");
        }
        else
        {
            $('header').removeClass("sticky");
        }
    });
    </script>
</head>
<body>
<header>
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
<tbody>
    <tr style="height: 56px;">
        <td id="projectlogo"><a href="http://www.onixs.biz"><img alt="Logo" src="onixs.svg"/></a></td>
        <td style="padding-left: 0.5em;">
            <div id="projectname">OnixS C++ B3 BOE Binary Order Entry
            &#160;<span id="projectnumber">1.3.0</span>
            </div>
            <div id="projectbrief">API Documentation</div>
        </td>
    </tr>
</tbody>
</table>
</div>
</header>
<div id="wrapper">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Home</span></a></li>
      <li class="current"><a href="modules.html"><span>Contents</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Threading Models<div class="ingroups"><a class="el" href="group__advanced-programming.html">Advanced Programming</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The handler supports the following threading models for usual sockets:</p>
<ul>
<li><a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a6e32e8ef9a95c3a15c82f1918b465e6a" title="Each session has a sender thread and a receiving thread. ">OnixS::B3::BOE::ThreadingModel::Dedicated</a></li>
<li><a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091ae5ed7d2e4929f1a2986c4bb89b8a1a90" title="Sessions share a thread pool. ">OnixS::B3::BOE::ThreadingModel::Pool</a></li>
<li><a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a></li>
</ul>
<p>The <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a> mode supports the Solarflare TCPDirect technology that is described in the <a class="el" href="group__solarflare-specific-features.html#tcpdirect">Solarflare TCPDirect</a> section.</p>
<p>The model is configured via the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionSettings.html#a44b95d304116c944c0d8a6bf8b52d74c" title="Sets the threading model. ">OnixS::B3::BOE::SessionSettings::threadingModel(ThreadingModel::Enum value)</a> method.</p>
<h1><a class="anchor" id="Dedicated"></a>
Dedicated</h1>
<p>In <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a6e32e8ef9a95c3a15c82f1918b465e6a" title="Each session has a sender thread and a receiving thread. ">OnixS::B3::BOE::ThreadingModel::Dedicated</a> mode the Handler creates a dedicated receiving thread and a dedicated sending thread for each <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html" title="A FIXP Session. ">OnixS::B3::BOE::Session</a> instance.</p>
<p>The receiving thread receives and processes incoming SBE messages.</p>
<p>The Handler tries to send an outgoing application-level message in the thread that calls the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ad244c9903b4d4aea32acf60905cd8536" title="Sends the message. ">OnixS::B3::BOE::Session::send</a> method. If the message cannot be sent immediately, then it is saved to the queue for the subsequent sending by the sending thread. This behavior can be changed using the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#a05b3c194b5c410fab9b80841952ca85a">OnixS::B3::BOE::Session::messageGrouping</a> method.</p>
<p>The following table shows which thread could fire a particular callback.</p>
<table class="doxtable">
<tr>
<th>Callback </th><th>Application thread</th><th>Sending thread </th><th>Receiving thread  </th></tr>
<tr>
<td><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html#a640d349367dd6b4457552b4d7ce322fd" title="Called when an error condition is detected. ">OnixS::B3::BOE::SessionListener::onError</a> </td><td>No </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td><code>OnixS::B3::BOE::SessionListener::on*(messageName)</code> </td><td>No </td><td>No </td><td>Yes </td></tr>
<tr>
<td><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html#a5923dc6ca6f8dab61cf463b7b0102740" title="Called as soon as bytes are received from the wire. ">OnixS::B3::BOE::SessionListener::onReceivedBytes</a> </td><td>No </td><td>No </td><td>Yes </td></tr>
<tr>
<td><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html#a2801c5da78f8216018d5e8648b25b690" title="Called when the SBE message is about to be sent to the wire. ">OnixS::B3::BOE::SessionListener::onMessageSending</a> </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html#a5d3f48847cc160cc668fc8809476150b" title="Called when the session changes its state. ">OnixS::B3::BOE::SessionListener::onStateChange</a> </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
<tr>
<td><a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionListener.html#a7c9d1387b3b0935960fdf2fc5f107639" title="Called when a warning condition is detected. ">OnixS::B3::BOE::SessionListener::onWarning</a> </td><td>Yes </td><td>Yes </td><td>Yes </td></tr>
</table>
<h1><a class="anchor" id="Pool"></a>
Pool</h1>
<p>In <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091ae5ed7d2e4929f1a2986c4bb89b8a1a90" title="Sessions share a thread pool. ">OnixS::B3::BOE::ThreadingModel::Pool</a> mode the Handler creates the thread pool and shares it between all sessions. The maximum number of threads in the pool is configured via the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionSettings.html#a3cee2fad270b320ac0c009129957a4a2">OnixS::B3::BOE::SessionSettings::threadPoolSize</a> parameter. The default value (<code>0</code>) of this parameter means that the thread pool's size will be equal to the CPU's number. In the thread pool, each thread performs read/write operations and can process a number of different FIXP connections, which are distributed equally among all threads. The thread pool is used also to perform the asynchronous TCP connect when the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ad002fedb18c8762bc2e9623e77b827a1" title="Establishes the connection asynchronously. ">OnixS::B3::BOE::Session::connectAsync()</a> method is called.</p>
<h1><a class="anchor" id="External"></a>
External</h1>
<p>In <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a> mode the Handler does not create I/O threads. Such mode means that user creates additional threads himself (or uses the main thread), then performs event dispatching in a loop by calling the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1SessionReactor.html#a49ef1473539af81a379e309aca52d98b" title="Processes events on a stack and performs the necessary handling. ">OnixS::B3::BOE::SessionReactor::dispatchEvents()</a> routine. This mode supports the Solarflare's TCPDirect and regular TCP connections. For TCPDirect connections, one should use the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpDirectStack.html" title="A high-level wrapper over the TCPDirect network stack. ">OnixS::B3::BOE::TcpDirectStack</a> as a reactor. For regular TCP connections, one should use <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1TcpStandardStack.html" title="A high-level wrapper over the TCP standard stack. ">OnixS::B3::BOE::TcpStandardStack</a> as a reactor.</p>
<dl class="section note"><dt>Note</dt><dd>The TCPDirect technology is NOT thread-safe. Therefore, the event dispatching and message sending should be performed from the same thread.</dd>
<dd>
<a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a> mode is set automatically when an external reactor is provided to the session's constructor, regardless of which threading model was specified by SessionSettings. If <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a977cc667a6db29d9dd079d6b6d3b8e9b" title="Session events are handled by rolling an event loop in a user thread. ">OnixS::B3::BOE::ThreadingModel::External</a> mode is configured, but an external reactor is not provided during Session's construction, an exception will be thrown.</dd></dl>
<h1><a class="anchor" id="additional-threads-that-can-be-spawned"></a>
Additional Threads That Can Be Spawned</h1>
<p>If the configured threading model equals <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1ThreadingModel.html#a8150b7776c2a1749101acf22e868d091a6e32e8ef9a95c3a15c82f1918b465e6a" title="Each session has a sender thread and a receiving thread. ">OnixS::B3::BOE::ThreadingModel::Dedicated</a> and the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ad002fedb18c8762bc2e9623e77b827a1" title="Establishes the connection asynchronously. ">OnixS::B3::BOE::Session::connectAsync()</a> method is used, the Handler creates a separate thread to perform the asynchronous TCP connect. Each such thread is started when the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html#ad002fedb18c8762bc2e9623e77b827a1" title="Establishes the connection asynchronously. ">OnixS::B3::BOE::Session::connectAsync()</a> method is called and is stopped when the asynchronous TCP connect is completed.</p>
<p>If the <a class="el" href="structOnixS_1_1B3_1_1BOE_1_1SessionStorageType.html#a8150b7776c2a1749101acf22e868d091a5eac26692eabaded6eaf8222dc05870e" title="Asynchronous File-Based Session Storage. ">OnixS::B3::BOE::SessionStorageType::AsyncFileBased</a> value is passed to the <a class="el" href="classOnixS_1_1B3_1_1BOE_1_1Session.html" title="A FIXP Session. ">OnixS::B3::BOE::Session</a> constructor, the Handler creates an additional thread for each <code>Session</code> instance. This thread performs session storage operations.</p>
<p>When a session has some network issues, the Handler will restore the FIXP connection. For this purpose, a separate thread is created to avoid blocking Handler's IO threads in non-TCPDirect connection modes. </p>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<footer>
<hr class="footer"/>
<address class="footer">
    <small>&copy; <a href="http://www.onixs.biz">Onix Solutions [On<span class="corporate-orange">i</span>x<span class="corporate-orange">S</span>]</a>. All rights reserved.</small>
</address>
</footer>
</div> <!-- wrapper -->
</body>
</html>
